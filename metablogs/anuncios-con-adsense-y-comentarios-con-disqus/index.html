<!doctype html><html i-amphtml-layout i-amphtml-no-boilerplate lang=es transformed="google;v=2" ⚡><head><meta charset=utf-8><style amp-runtime i-amphtml-version=latest></style><meta content="width=device-width,minimum-scale=1,initial-scale=1" name=viewport><meta content="He probado varios sistemas de comentarios y me he decantado por meter Disqus en Amperage. Para monetizar también he integrado anuncios de Adsense compatibles con AMP" name=description><meta content="Metablog #10 - Comentarios con Disqus y anuncios con Adsense" property=og:title><meta content=https://asur.dev/metablogs/anuncios-con-adsense-y-comentarios-con-disqus/ property=og:url><meta content="He probado varios sistemas de comentarios y me he decantado por meter Disqus en Amperage. Para monetizar también he integrado anuncios de Adsense compatibles con AMP" property=og:description><meta content=https://asur.dev/images/anuncios-con-adsense-y-comentarios-con-disqus/share-card.jpg property=og:image><meta content=article property=og:type><meta content property=og:site_name><meta content=summary_large_image name=twitter:card><meta content="Metablog #10 - Comentarios con Disqus y anuncios con Adsense" name=twitter:title><meta content=https://asur.dev/metablogs/anuncios-con-adsense-y-comentarios-con-disqus/ name=twitter:url><meta content="He probado varios sistemas de comentarios y me he decantado por meter Disqus en Amperage. Para monetizar también he integrado anuncios de Adsense compatibles con AMP" name=twitter:description><meta content=https://asur.dev/images/anuncios-con-adsense-y-comentarios-con-disqus/share-card.jpg name=twitter:image><meta content=@asurbernardo name=twitter:site><meta content=#333 name=theme-color><script async src=https://cdn.ampproject.org/v0.js></script><script async custom-element=amp-analytics src=https://cdn.ampproject.org/v0/amp-analytics-0.1.js></script><script async custom-element=amp-iframe src=https://cdn.ampproject.org/v0/amp-iframe-0.1.js></script><script async custom-element=amp-install-serviceworker src=https://cdn.ampproject.org/v0/amp-install-serviceworker-0.1.js></script><script async custom-element=amp-social-share src=https://cdn.ampproject.org/v0/amp-social-share-0.1.js></script><script async custom-element=amp-twitter src=https://cdn.ampproject.org/v0/amp-twitter-0.1.js></script><link href=https://asur-dev.cdn.ampproject.org/i/s/asur.dev/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=https://asur-dev.cdn.ampproject.org/i/s/asur.dev/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href rel="dns-prefetch preconnect"><link href=https://asur-dev.cdn.ampproject.org rel="dns-prefetch preconnect"><style amp-custom>*,*::before,*::after{box-sizing:border-box}ul[class],ol[class]{padding:0}body,h1,h2,h3,h4,p,ul[class],ol[class],li,figure,figcaption,blockquote,dl,dd{margin:0}body{min-height:100vh;scroll-behavior:smooth;text-rendering:optimizeSpeed}ul[class],ol[class]{list-style:none}a:not([class]){text-decoration-skip-ink:auto}img{max-width:100%;display:block}input,button,textarea,select{font:inherit}.chroma{background-color:#fff}.chroma .err{color:#a61717;background-color:#e3d2d2}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block}.chroma .hl{display:block;width:100%;background-color:#ffc}.chroma .lnt{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .ln{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .k{color:#000;font-weight:700}.chroma .kc{color:#000;font-weight:700}.chroma .kd{color:#000;font-weight:700}.chroma .kn{color:#000;font-weight:700}.chroma .kp{color:#000;font-weight:700}.chroma .kr{color:#000;font-weight:700}.chroma .kt{color:#458;font-weight:700}.chroma .na{color:teal}.chroma .nb{color:#0086b3}.chroma .bp{color:#999}.chroma .nc{color:#458;font-weight:700}.chroma .no{color:teal}.chroma .nd{color:#3c5d5d;font-weight:700}.chroma .ni{color:purple}.chroma .ne{color:#900;font-weight:700}.chroma .nf{color:#900;font-weight:700}.chroma .nl{color:#900;font-weight:700}.chroma .nn{color:#555}.chroma .nt{color:navy}.chroma .nv{color:teal}.chroma .vc{color:teal}.chroma .vg{color:teal}.chroma .vi{color:teal}.chroma .s{color:#d14}.chroma .sa{color:#d14}.chroma .sb{color:#d14}.chroma .sc{color:#d14}.chroma .dl{color:#d14}.chroma .sd{color:#d14}.chroma .s2{color:#d14}.chroma .se{color:#d14}.chroma .sh{color:#d14}.chroma .si{color:#d14}.chroma .sx{color:#d14}.chroma .sr{color:#009926}.chroma .s1{color:#d14}.chroma .ss{color:#990073}.chroma .m{color:#099}.chroma .mb{color:#099}.chroma .mf{color:#099}.chroma .mh{color:#099}.chroma .mi{color:#099}.chroma .il{color:#099}.chroma .mo{color:#099}.chroma .o{color:#000;font-weight:700}.chroma .ow{color:#000;font-weight:700}.chroma .c{color:#998;font-style:italic}.chroma .ch{color:#998;font-style:italic}.chroma .cm{color:#998;font-style:italic}.chroma .c1{color:#998;font-style:italic}.chroma .cs{color:#999;font-weight:700;font-style:italic}.chroma .cp{color:#999;font-weight:700;font-style:italic}.chroma .cpf{color:#999;font-weight:700;font-style:italic}.chroma .gd{color:#000;background-color:#fdd}.chroma .ge{color:#000;font-style:italic}.chroma .gr{color:#a00}.chroma .gh{color:#999}.chroma .gi{color:#000;background-color:#dfd}.chroma .go{color:#888}.chroma .gp{color:#555}.chroma .gs{font-weight:700}.chroma .gu{color:#aaa}.chroma .gt{color:#a00}.chroma .gl{text-decoration:underline}.chroma .w{color:#bbb}body{display:grid;grid-template-columns:repeat(12,1fr);grid-gap:1em 1em;font-size:1.2em;font-family:Courier New;line-height:2;color:#333}.header,.main,.footer{grid-column:4/span 6}.header{margin-top:1em}.header__menu{margin:0;padding:0;display:flex;overflow:auto;justify-content:flex-start;border:1px solid #333}.header__menu a{border-bottom:none}.header__menu a:hover{color:#d14}.header__menu__logo{line-height:0}.header__menu__logo svg{width:75px;height:75px;min-width:75px;min-height:75px}.header__menu__list{display:flex;flex-grow:1;flex-wrap:nowrap;align-items:center;justify-content:space-around}.header__menu__list li{padding:0 1em;display:inline}.main{min-height:80vh}.main .pagination{margin:2em auto;display:flex;justify-content:space-between}.main .pagination a{border-bottom:none}.main .pagination a:hover{color:#d14}.footer{display:flex;justify-content:space-between;flex-wrap:wrap}h1,h2,h3,h4{font-family:Helvetica;line-height:1.5}h1{font-size:4rem}h2{font-size:2.5rem}h3{font-size:2rem}h4{font-size:1.5rem}a{color:inherit;text-decoration:none;border-bottom:2px dashed #37474f;transition:background .3s}a:hover{border-color:#d14}li{margin-top:.25em}pre,code{font-family:lucida console,Monaco,monospace;font-size:12pt;background-color:#f1f1f1}blockquote{margin:inherit auto;margin-left:1em;padding:1em;border-left:5px solid #999}blockquote:before{display:none}blockquote:not(:first-of-type){margin-top:.5em}blockquote p{color:#555;font-size:1.25em;font-family:times new roman,serif}.figure{position:relative}.figure__caption{display:block;position:absolute;max-width:60%;bottom:1rem;left:-1rem;padding:0 1rem;background-color:#333;color:#fff;font-weight:700}.post-it{width:100%;padding:1.5em}.post-it--tip{background-color:#fffacd}.post-it--info{background-color:#87cefa}.post-it--danger{background-color:#f08080}.post-it__title{font-weight:700;font-size:1.5em}#tags{margin:0;padding:0}#tags li{display:inline}.content,.summary{width:100%}.content>*,.summary>*{margin-top:1.5em}.content>h1,.summary>h1{margin-top:.5em}.content pre,.summary pre{overflow:auto;padding:.5em}.content code,.summary code{padding:.1em}.content table,.summary table{display:block;overflow-x:auto;border-collapse:collapse}.content table td,.content table th,.summary table td,.summary table th{border:1px solid #ddd}.content table td,.summary table td{padding:.5em 1em}.content table th,.summary table th{padding:1em 2em;background-color:#333;color:#fff}.content table tr:nth-child(even),.summary table tr:nth-child(even){background-color:#f1f1f1}.content table tr:hover,.summary table tr:hover{background-color:#ddd}.content .highlight,.summary .highlight{overflow:auto}.content .highlight .chroma,.summary .highlight .chroma{background-color:#f1f1f1}.content .under-title,.summary .under-title{display:flex;flex-wrap:wrap;justify-content:space-between;line-height:1.5;font-size:1rem}.content .under-title__info,.content .under-title__social-share,.summary .under-title__info,.summary .under-title__social-share{align-self:center}.content .under-title__social-share,.summary .under-title__social-share{display:flex;align-items:center}.content .under-title__social-share__button,.summary .under-title__social-share__button{margin:0 .5em;border-radius:50%;background-size:60%}.content .ad,.summary .ad{display:flex;margin:1rem auto;align-content:center;width:min-content;height:min-content;min-width:320px;min-height:320px;border:1px solid #333}.content .ad__fallback,.summary .ad__fallback{display:flex;align-items:center}.content .ad__fallback p,.summary .ad__fallback p{margin:auto}@media(max-width:1200px){body{grid-gap:0}.main,.header,.footer{grid-column:1/span 12}.main,.footer{margin:.5em .75em 0 .5em}.header{margin:0}.header__menu{border:none;border-bottom:1px solid #333}h1{font-size:2.5rem}h2{font-size:2rem}h3{font-size:1.66rem}h4{font-size:1.25rem}.post-it{margin-left:0;margin-right:0}}@media(max-width:600px){.under-title__social-share{width:100%;margin-top:1.5em;justify-content:space-between}.figure{position:relative}.figure__caption{position:relative;max-width:100%}}</style><title>Metablog #10 - Comentarios con Disqus y anuncios con Adsense</title><link href=https://asur.dev/metablogs/anuncios-con-adsense-y-comentarios-con-disqus/ rel=canonical><link href=https://asur.dev/sitemap.xml rel=sitemap type=application/xml><link href=https://asur.dev/manifest.json rel=manifest><link href=https://asur.dev/icons/apple-touch-icon.png rel=apple-touch-icon sizes=180x180></head><body><amp-install-serviceworker class=i-amphtml-layout-nodisplay data-iframe-src=https://asur.dev/install-sw.html hidden=hidden i-amphtml-layout=nodisplay layout=nodisplay src=https://asur.dev/sw.js></amp-install-serviceworker><amp-analytics class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" data-credentials=include i-amphtml-layout=fixed style=width:1px;height:1px; type=gtag><script type=application/json>{"vars":{"gtag_id":"UA-128498798-1","config":{"UA-128498798-1":{"groups":"default"}}},"triggers":{"trackPageview":{"on":"visible","request":"pageview"}}}</script></amp-analytics><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/asur.dev","name":"Inicio"}},{"@type":"ListItem","position":2,"item":{"@id":"https:\/\/asur.dev\/metablogs\/","name":"Metablogs"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/asur.dev\/metablogs\/anuncios-con-adsense-y-comentarios-con-disqus\/","name":"Anuncios con adsense y comentarios con disqus"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","image":"https:\/\/asur.dev\/images\/anuncios-con-adsense-y-comentarios-con-disqus\/share-card.jpg","url":"https:\/\/asur.dev\/metablogs\/anuncios-con-adsense-y-comentarios-con-disqus\/","headline":"Metablog #10 - Comentarios con Disqus y anuncios con Adsense","alternativeHeadline":"Metablog #10 - Comentarios con Disqus y anuncios con Adsense","dateCreated":"2019-12-23T12:09:32","datePublished":"2019-12-23T12:09:32","dateModified":"2019-12-23T12:09:32","inLanguage":"es","isFamilyFriendly":"true","copyrightYear":"2019","copyrightHolder":"Asur","accountablePerson":{"@type":"Person","name":"Asur","url":"\/"},"author":{"@type":"Person","name":"Asur","url":"https:\/\/asur.dev\/"},"creator":{"@type":"Person","name":"Asur","url":"https:\/\/asur.dev\/"},"publisher":{"@type":"Organization","name":"Asur Bernardo","url":"https:\/\/asur.dev","logo":{"@type":"ImageObject","url":"\/logo-amp-article.png","width":"600","height":"60"}},"mainEntityOfPage":"https:\/\/asur.dev\/metablogs\/anuncios-con-adsense-y-comentarios-con-disqus\/","keywords":"[\"blog\",\"desarrollo\",\"anuncios\",\"adsense\",\"amp\",\"comentarios\",\"disqus\"]","genre":"[\"Evolutivo\"]","articleSection":"Los metablogs | By Asur 🧐"}</script><header class=header><nav class=header__menu><a aria-label="Volver a la página de inicio" class=header__menu__logo data-rel=prefetch href=https://asur.dev target=_top><svg viewbox="0 0 39.687 39.688"><g transform="translate(0 -257.31)"><path d="M-4.7247 254.1h46.68v44.507h-46.68z" fill=#333 stroke-width=.26458></path><g aria-label=a/ fill=#fff stroke-width=.47195 transform="matrix(.95987 0 0 .99672 -.00047323 11.993)"><path d="m16.898 272.93v-7.3088c0-3.0104-1.9104-4.9208-5.7023-4.9208-1.4762.0-3.1262.26052-4.9787.95522l.63681 1.8381c1.5775-.54997 2.9525-.78154 3.9656-.78154 2.2723.0 3.6327.82496 3.6327 3.0248v1.2736h-2.2433c-4.6313.0-7.1496 1.7368-7.1496 4.8774.0 2.8367 1.867 4.7037 4.9208 4.7037 1.9683.0 3.6906-.72365 4.7761-2.142.43419 1.3605 1.4762 1.9683 2.7933 2.142l.59339-1.7078c-.8539-.26051-1.2447-.72365-1.2447-1.9538zm-6.2957 1.8091c-1.9828.0-2.938-.98416-2.938-2.8801.0-1.9538 1.2302-3.1985 4.5879-3.1985h2.1999v3.9222c-.91179 1.3605-2.3446 2.1565-3.8498 2.1565z" style=font-feature-settings:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal></path><path d="m23.928 279.24 12.36-25.458-1.9394-.95521-12.389 25.545z" style=font-feature-settings:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal></path></g></g></svg></a><ul class=header__menu__list><li><a href=https://github.com/asurbernardo rel="nofollow noopener noreferrer" target=_blank><span>GitHub</span></a></li><li><a href=https://www.linkedin.com/in/asur-bernardo rel="nofollow noopener noreferrer" target=_blank><span>LinkedIn</span></a></li><li><a href=https://twitter.com/asurbernardo rel="nofollow noopener noreferrer" target=_blank><span>Twitter</span></a></li><li><a data-rel=prefetch href=https://asur.dev/support target=_top><span>Apóyame</span></a></li></ul></nav></header><main class=main><article class=content><h1 id=comentarios-con-disqus-y-anuncios-con-adsense>Comentarios con Disqus y anuncios con Adsense</h1><section class=under-title><div class=under-title__info><time datetime=2019-12-23T12:09:32>23 de Diciembre 2019</time> por Asur<ul id=tags><li>Tags:</li> <li><a data-rel=prefetch href=https://asur.dev/tags/evolutivo/ target=_top>Evolutivo</a></li></ul></div><div class=under-title__social-share><amp-social-share aria-label="Compartir contenido" class="under-title__social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=system width=50></amp-social-share><amp-social-share aria-label="Compartir en Facebook" class="under-title__social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=facebook width=50></amp-social-share><amp-social-share aria-label="Compartir en Twitter" class="under-title__social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=twitter width=50></amp-social-share><amp-social-share aria-label="Compartir en Linkedin" class="under-title__social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=linkedin width=50></amp-social-share><amp-social-share aria-label="Compartir en Pinterest" class="under-title__social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=pinterest width=50></amp-social-share></div></section><p>Pues parece que sí que había tareas en la recámara al final, ¿no? Una nueva revisión de Amperage ya está aquí y trae novedades muy top con historias de superación incluidas! 😬</p><p><b>Tabla de contenidos:</b></p><nav id=TableOfContents><ul><li><a href=#comentarios-con-disqus-y-anuncios-con-adsense>Comentarios con Disqus y anuncios con Adsense</a><ul><li><a href=#comentarios-con-disqus>Comentarios con Disqus 💬</a><ul><li><a href=#integración-con-amp>Integración con AMP</a></li></ul></li><li><a href=#anuncios-con-adsense>Anuncios con Adsense 🛒</a></li><li><a href=#próximo-destino>Próximo destino 🛣️</a></li><li><a href=#wayback-machine>Wayback machine ⏰</a></li></ul></li></ul></nav><p></p><h2 id=comentarios-con-disqus>Comentarios con Disqus 💬</h2><p>Después de probar varios sistemas de comentarios independientes como Commento y Remark le he estado dando vueltas y me he dado cuenta de que no es viable.</p><p>El hecho de que todo el mundo que quiera utilizar este tema tenga que montarse su propia infraestructura y desplegar una imagen de Docker no es realista.</p><p>Por esto he decidido que, para llegar a la mayor cantidad de gente posible la mejor opción es <strong>Disqus</strong>.</p><h3 id=integración-con-amp>Integración con AMP</h3><p>El mayor problema de crear cualquier sistema de comentarios en Amperage es la integración con AMP y Disqus no es ninguna excepción.</p><p>Por suerte el equipo de Disqus ha creado <a href=https://github.com/disqus/disqus-install-examples/tree/master/google-amp target=_top>una guía de integración</a> para hacerle la vida más fácil a los desarrolladores.</p><p>Aún así he estado a punto de tirar la toalla con esta feature debido a un comportamiento inesperado del componente <code>amp-iframe</code> que casi me vuelve loco.</p><p>Todo empieza con la necesidad por parte de AMP de asignar un espacio inicial a todos los componentes para evitar el <a href=https://css-tricks.com/content-jumping-avoid/ target=_top>content jumping</a>.</p><blockquote><p>Todo bien, ¿no? ¡Esto mejora la experiencia de usuario! ¿no? ¿NO? 🤩</p></blockquote><p>Si por supuesto, ¡a tope con UX! <strong>El problema viene cuando tienes que asignar un tamaño fijo a un contenido de tamaño variable</strong>, como una caja de comentarios. El resultado es que o bien aparece un espacio en blanco o bien el contenido está cortado.</p><p>El equipo de AMP ya había pensado en esto y hay una <a href=https://amp.dev/es/documentation/components/amp-iframe/#cambio-de-tama%C3%B1o-del-iframe target=_top>manera oficial de hacer resize de un iframe</a> una vez este se ha cargado. El contenido embebido debe postear un mensaje del tipo <code>embed-size</code> al centinela <code>amp</code>. Algo así:</p><div class=highlight><div class=chroma><table class=lntable><tbody><tr><td class=lntd><pre class=chroma><code class=language-javascript data-lang=javascript><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-javascript data-lang=javascript><span class=nb>window</span><span class=p>.</span><span class=nx>parent</span><span class=p>.</span><span class=nx>postMessage</span><span class=p>({</span>
  <span class=nx>sentinel</span><span class=o>:</span> <span class=s1>&#39;amp&#39;</span><span class=p>,</span>
  <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;embed-size&#39;</span><span class=p>,</span>
  <span class=nx>height</span><span class=o>:</span> <span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>scrollHeight</span>
<span class=p>},</span> <span class=s1>&#39;*&#39;</span><span class=p>);</span>
</code></pre></td></tr></tbody></table></div></div><p>Pero la cosa no queda ahí, tu iframe tiene que venir <strong>obligatoriamente</strong> de un dominio distinto, tener el atributo <code>sandbox=&#34;allow-same-origin&#34;</code> y contener un elemento <code>overflow</code>. Este es el mío:</p><div class=highlight><div class=chroma><table class=lntable><tbody><tr><td class=lntd><pre class=chroma><code class=language-go-html-template data-lang=go-html-template><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go-html-template data-lang=go-html-template><span class=cp>{{</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=nx>isset</span><span class=w> </span><span class=na>.Site.Params</span><span class=w> </span><span class=s>&#34;commentsembedurl&#34;</span><span class=w> </span><span class=cp>}}</span>
    <span class=p>&lt;</span><span class=nt>amp-iframe</span> <span class=na>width</span><span class=o>=</span><span class=s>600</span> <span class=na>height</span><span class=o>=</span><span class=s>180</span>
        <span class=na>layout</span><span class=o>=</span><span class=s>&#34;responsive&#34;</span>
        <span class=na>sandbox</span><span class=o>=</span><span class=s>&#34;allow-scripts allow-same-origin allow-modals allow-popups allow-forms&#34;</span>
        <span class=na>resizable</span>
        <span class=na>src</span><span class=o>=</span><span class=s>&#34;</span><span class=cp>{{</span><span class=w> </span><span class=na>.Site.Params.CommentsEmbedUrl</span><span class=w> </span><span class=cp>}}</span><span class=s>#</span><span class=cp>{{</span><span class=w> </span><span class=na>.Page.URL</span><span class=w> </span><span class=cp>}}</span><span class=s>&#34;</span><span class=p>&gt;</span>
        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>overflow</span>
            <span class=na>tabindex</span><span class=o>=</span><span class=s>0</span>
            <span class=na>role</span><span class=o>=</span><span class=s>button</span>
            <span class=na>aria-label</span><span class=o>=</span><span class=s>&#34;Load more&#34;</span>
            <span class=na>style</span><span class=o>=</span><span class=s>&#34;display:block;font-size:12px; [...]&#34;</span><span class=p>&gt;</span>
            Load more
        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
    <span class=p>&lt;/</span><span class=nt>amp-iframe</span><span class=p>&gt;</span>
<span class=cp>{{</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span></code></pre></td></tr></tbody></table></div></div><p>Leí por ahí que con hacer un subdominio con una redirección a mi dominio principal valdría, es decir, crear un <code>disqus.asur.dev</code> que redireccionase a <code>asur.dev/disqus.html</code>.</p><p>Efectivamente el iframe funcionaba sin problemas y no daba ningún fallo, pero no hacía el resize!</p><p>Me pasé horas debugueando, pero no había ningún error, el <code>postMessage</code> se enviaba bien, con la altura correcta pero el componente parecía ignorarlo.</p><p>Si trabajas en <code>localhost</code> tu iframe no puede venir de <code>localhost</code> también porque casca, así que un rato después me dió por montar un túnel a mi local para poder probarlo sin tener que hacer ningún despliegue y el resize funcionaba! WTF?</p><p>Parece que <strong>el truco de la redirección funciona genial a no ser que quieras hacer un resize</strong> por alguna razón interna de AMP…</p><p>Tras este descubrimiento lo que hice fué deshacer los registros en el DNS y alojar un <a href=https://github.com/asurbernardo/blog-comments target=_top>nuevo proyecto en Github Pages</a> con el fichero de la guía de instalación de Disqus y el dominio <code>disqus.asur.dev</code>, en esta ocasión 100% independiente del principal (<code>asur.dev</code>).</p><p><strong>¡Y FUNCIONÓ! ¡POR FIN!</strong> 😭</p><p>La verdad es que no es la manera más fácil de añadir comentarios a un blog, pero es lo que hay, seguiré iterando y probando otros sistemas de comentarios nuevos, pero <strong>lo que de verdad me gustaría es hacer el tema agnóstico</strong> a estos!</p><h2 id=anuncios-con-adsense>Anuncios con Adsense 🛒</h2><p>Hay mucha gente que busca el poder monetizar su presencia online. Para habilitar esto he creado unos nuevos shortcodes que imprimer automáticamente un anuncio.</p><p>He utilizado <strong>Adsense</strong> por la misma razón que Disqus, por el alto grado de adopción que tiene para que el tema le sirva a la mayor cantidad de gente posible <em>out of the box</em>.</p><p>El principal problema que me he encontrado es la validación de mi web, resulta que Adsense requiere que insertes un script en tu web, pero al tener AMP al hacerlo deja de ser válido.</p><p>Les twitee al respecto:</p><p><amp-twitter class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" data-tweetid=1204358886112804864 height=330 i-amphtml-layout=fixed layout=fixed style=width:390px;height:330px; width=390></amp-twitter></p><p>No sé si ha tenido que ver, lo dudo la verdad, pero <strong>a las 24 horas tenía la web validada, sin script ni nada!</strong> 🥳</p><p>Con la web ya habilitada en Adsense me puedo poner a hacer pruebas, porque déjame decirte que esto de los anuncios tiene más miga de lo que parece.</p><p>Empecé probando un tipo de anuncio que es responsive, es decir, cambia su contenido dependiendo del viewport. Esta opción suena muy bien sobre el papel pero requiere darle todo el ancho de la web (<code>width=&#34;100vw&#34;</code>), lo que no queda bien con el estilo de columna de Amperage.</p><p>Al final he optado por dar todo el poder al usuario y crear un <em>shortcode</em> en el que puedas especificar tanto el tipo de anuncio como el tamaño.</p><p>Una versión simplificada del código del shortcode:</p><div class=highlight><div class=chroma><table class=lntable><tbody><tr><td class=lntd><pre class=chroma><code class=language-go-html-template data-lang=go-html-template><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go-html-template data-lang=go-html-template><span class=cp>{{</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=nx>isset</span><span class=w> </span><span class=na>$.Site.Params</span><span class=w> </span><span class=s>&#34;adsensepublisher&#34;</span><span class=w> </span><span class=cp>}}</span>
    <span class=cp>{{</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=na>.Params</span><span class=w> </span><span class=cp>}}</span>
        <span class=p>&lt;</span><span class=nt>fieldset</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;ad&#34;</span><span class=p>&gt;</span>
            <span class=p>&lt;</span><span class=nt>legend</span><span class=p>&gt;&lt;</span><span class=nt>b</span><span class=p>&gt;</span>#ad<span class=p>&lt;/</span><span class=nt>b</span><span class=p>&gt;&lt;/</span><span class=nt>legend</span><span class=p>&gt;</span>
            <span class=p>&lt;</span><span class=nt>amp-ad</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;adsense&#34;</span>
                <span class=cp>{{</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=na>.class</span><span class=w> </span><span class=cp>}}</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;</span><span class=cp>{{</span><span class=w> </span><span class=na>.</span><span class=w> </span><span class=cp>}}</span><span class=s>&#34;</span><span class=cp>{{</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span>
                <span class=cp>{{</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=na>.alt</span><span class=w> </span><span class=cp>}}</span> <span class=na>alt</span><span class=o>=</span><span class=s>&#34;</span><span class=cp>{{</span><span class=w> </span><span class=na>.</span><span class=w> </span><span class=cp>}}</span><span class=s>&#34;</span><span class=cp>{{</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span>
                <span class=cp>{{</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=na>.width</span><span class=w> </span><span class=cp>}}</span> <span class=na>width</span><span class=o>=</span><span class=s>&#34;</span><span class=cp>{{</span><span class=w> </span><span class=na>.</span><span class=w> </span><span class=cp>}}</span><span class=s>&#34;</span><span class=cp>{{</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span>
                <span class=cp>{{</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=na>.height</span><span class=w> </span><span class=cp>}}</span> <span class=na>height</span><span class=o>=</span><span class=s>&#34;</span><span class=cp>{{</span><span class=w> </span><span class=na>.</span><span class=w> </span><span class=cp>}}</span><span class=s>&#34;</span><span class=cp>{{</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span>
                <span class=cp>{{</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=na>.layout</span><span class=w> </span><span class=cp>}}</span> <span class=na>layout</span><span class=o>=</span><span class=s>&#34;</span><span class=cp>{{</span><span class=w> </span><span class=na>.</span><span class=w> </span><span class=cp>}}</span><span class=s>&#34;</span><span class=cp>{{</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span>
                <span class=cp>{{</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=na>.slot</span><span class=w> </span><span class=cp>}}</span> <span class=na>data-ad-slot</span><span class=o>=</span><span class=s>&#34;</span><span class=cp>{{</span><span class=w> </span><span class=na>.</span><span class=w> </span><span class=cp>}}</span><span class=s>&#34;</span> <span class=cp>{{</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span>
                <span class=na>data-ad-client</span><span class=o>=</span><span class=s>&#34;</span><span class=cp>{{</span><span class=w> </span><span class=na>$.Site.Params.adsensePublisher</span><span class=w> </span><span class=cp>}}</span><span class=s>&#34;</span><span class=p>&gt;</span>
                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;ad__fallback&#34;</span> <span class=na>fallback</span><span class=p>&gt;&lt;</span><span class=nt>p</span><span class=p>&gt;</span>No ad for you! :(<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
            <span class=p>&lt;/</span><span class=nt>amp-ad</span><span class=p>&gt;</span>
        <span class=p>&lt;/</span><span class=nt>fieldset</span><span class=p>&gt;</span>
    <span class=cp>{{</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span>
<span class=cp>{{</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span></code></pre></td></tr></tbody></table></div></div><p>Un ejemplo de uso:</p><pre><code>{{&lt; amp-adsense
    width=&#34;320&#34;
    height=&#34;320&#34;
    layout=&#34;fixed&#34;
    slot=&#34;9425131909&#34; &gt;}}
</code></pre><p>Lo único que hay que hacer para empezar a utilizarlo es añadir tu código de <em>publisher</em> en la configuración del site.</p><p>Por supuesto todo esto genera un código de anuncio válido para AMP. El resultado final:</p><fieldset class=ad><legend><b>#ad</b></legend>
<amp-ad class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" data-ad-client=ca-pub-8268925024957381 data-ad-slot=9425131909 height=320 i-amphtml-layout=fixed layout=fixed style=width:320px;height:320px; type=adsense width=320><div class=ad__fallback fallback><p>Te quedas sin anuncio!</p></div></amp-ad></fieldset><p>Ahora ya sabes, a refrescar la página para darme dinero! 💸</p><h2 id=próximo-destino>Próximo destino 🛣️</h2><p>Voy a crear nuevos componentes visuales para los artículos, como nuevos bloques para hacer comparativas, bloques para linkear productos de Amazon, leyendas para las imágenes y más… Todo para darle un poco más de flexibilidad al blog y mejorar la experiencia de lectura evitando los <em>wall of text</em>. <em>Stay tuned!</em> 😎</p><h2 id=wayback-machine>Wayback machine ⏰</h2><p>Ver la <a href=# title="Versión original del post">versión original de este post</a>.</p><h2 class=related-content__title>Lecturas relacionadas 📖</h2><p class=related-content__item><a data-rel=prefetch href=https://asur.dev/metablogs/ssr-de-amp-en-build-time-con-github-actions/ target=_top>Metablog #7 - SSR de AMP en build time con GH actions</a></p><p class=related-content__item><a data-rel=prefetch href=https://asur.dev/metablogs/pwa-en-amp-con-service-worker-e-i18n/ target=_top>Metablog #6 - PWA y soporte multi-idioma</a></p><p class=related-content__item><a data-rel=prefetch href=https://asur.dev/metablogs/sistema-de-comentarios-gcp-y-datos-estructurados/ target=_top>Metablog #5 - Sistema de comentarios y datos estructurados</a></p><amp-iframe class="i-amphtml-layout-responsive i-amphtml-layout-size-defined" height=180 i-amphtml-layout=responsive layout=responsive resizable sandbox="allow-scripts allow-same-origin allow-modals allow-popups allow-forms" src="https://comments.asur.dev?id=c621b92baa366adc0c323fe2534885f7&amp;url=https%3a%2f%2fasur.dev%2fmetablogs%2fanuncios-con-adsense-y-comentarios-con-disqus%2f" width=600><i-amphtml-sizer style=display:block;padding-top:30.0000%;></i-amphtml-sizer><div aria-label="Load more" overflow role=button style="display:block;font-size:14px;font-weight:500;text-align:center;line-height:1.1;padding:12px 16px;border-radius:4px;background:rgba(29,47,58,.6);color:#fff" tabindex=0>Load more</div></amp-iframe></article></main><footer class=footer><div class=footer__copyright>© asur.dev 2020</div><div class=footer__languages><b>Español</b>
<a data-rel=prefetch href=https://asur.dev/en target=_top>English</a></div></footer></body></html>
