<!doctype html><html i-amphtml-layout i-amphtml-no-boilerplate lang=es transformed="google;v=2" ⚡><head><meta charset=utf-8><style amp-runtime i-amphtml-version=latest></style><meta content="width=device-width,minimum-scale=1,initial-scale=1" name=viewport><meta content="Creo una PWA en AMP utilizando service workers para poder instalarla en tu móvil y accder offline, además añado i18n con una nueva sección en inglés!" name=description><meta content=#ef8b80 name=theme-color><meta content="Metablog #6 - PWA y soporte multi-idioma" property=og:title><meta content=https://asur.dev/metablogs/pwa-en-amp-con-service-worker-e-i18n/ property=og:url><meta content="Creo una PWA en AMP utilizando service workers para poder instalarla en tu móvil y accder offline, además añado i18n con una nueva sección en inglés!" property=og:description><meta content=https://asur.dev/images/pwa-en-amp-con-service-worker-e-i18n.jpg property=og:image><meta content=article property=og:type><meta content property=og:site_name><meta content=summary_large_image name=twitter:card><meta content="Metablog #6 - PWA y soporte multi-idioma" name=twitter:title><meta content=https://asur.dev/metablogs/pwa-en-amp-con-service-worker-e-i18n/ name=twitter:url><meta content="Creo una PWA en AMP utilizando service workers para poder instalarla en tu móvil y accder offline, además añado i18n con una nueva sección en inglés!" name=twitter:description><meta content=https://asur.dev/images/pwa-en-amp-con-service-worker-e-i18n.jpg name=twitter:image><meta content=@asurbernardo name=twitter:site><script async src=https://cdn.ampproject.org/v0.js></script><script async custom-element=amp-analytics src=https://cdn.ampproject.org/v0/amp-analytics-0.1.js></script><script async custom-element=amp-install-serviceworker src=https://cdn.ampproject.org/v0/amp-install-serviceworker-0.1.js></script><script async custom-element=amp-script src=https://cdn.ampproject.org/v0/amp-script-0.1.js></script><script async custom-element=amp-social-share src=https://cdn.ampproject.org/v0/amp-social-share-0.1.js></script><script async custom-element=amp-twitter src=https://cdn.ampproject.org/v0/amp-twitter-0.1.js></script><link href=https://asur-dev.cdn.ampproject.org/i/s/asur.dev/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=https://asur-dev.cdn.ampproject.org/i/s/asur.dev/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href rel="dns-prefetch preconnect"><link href=https://asur-dev.cdn.ampproject.org rel="dns-prefetch preconnect"><style amp-custom>*,*::before,*::after{box-sizing:border-box}ul[class],ol[class]{padding:0}body,h1,h2,h3,h4,p,ul[class],ol[class],li,figure,figcaption,blockquote,dl,dd{margin:0}body{min-height:100vh;scroll-behavior:smooth;text-rendering:optimizeSpeed;line-height:1.5}ul[class],ol[class]{list-style:none}a:not([class]){text-decoration-skip-ink:auto}img{max-width:100%;display:block}input,button,textarea,select{font:inherit}article>*{margin-top:1em}article h1{margin-top:.25em}.chroma{background-color:#fff}.chroma .err{color:#a61717;background-color:#e3d2d2}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block}.chroma .hl{display:block;width:100%;background-color:#ffc}.chroma .lnt{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .ln{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .k{color:#000;font-weight:700}.chroma .kc{color:#000;font-weight:700}.chroma .kd{color:#000;font-weight:700}.chroma .kn{color:#000;font-weight:700}.chroma .kp{color:#000;font-weight:700}.chroma .kr{color:#000;font-weight:700}.chroma .kt{color:#458;font-weight:700}.chroma .na{color:teal}.chroma .nb{color:#0086b3}.chroma .bp{color:#999}.chroma .nc{color:#458;font-weight:700}.chroma .no{color:teal}.chroma .nd{color:#3c5d5d;font-weight:700}.chroma .ni{color:purple}.chroma .ne{color:#900;font-weight:700}.chroma .nf{color:#900;font-weight:700}.chroma .nl{color:#900;font-weight:700}.chroma .nn{color:#555}.chroma .nt{color:navy}.chroma .nv{color:teal}.chroma .vc{color:teal}.chroma .vg{color:teal}.chroma .vi{color:teal}.chroma .s{color:#d14}.chroma .sa{color:#d14}.chroma .sb{color:#d14}.chroma .sc{color:#d14}.chroma .dl{color:#d14}.chroma .sd{color:#d14}.chroma .s2{color:#d14}.chroma .se{color:#d14}.chroma .sh{color:#d14}.chroma .si{color:#d14}.chroma .sx{color:#d14}.chroma .sr{color:#009926}.chroma .s1{color:#d14}.chroma .ss{color:#990073}.chroma .m{color:#099}.chroma .mb{color:#099}.chroma .mf{color:#099}.chroma .mh{color:#099}.chroma .mi{color:#099}.chroma .il{color:#099}.chroma .mo{color:#099}.chroma .o{color:#000;font-weight:700}.chroma .ow{color:#000;font-weight:700}.chroma .c{color:#998;font-style:italic}.chroma .ch{color:#998;font-style:italic}.chroma .cm{color:#998;font-style:italic}.chroma .c1{color:#998;font-style:italic}.chroma .cs{color:#999;font-weight:700;font-style:italic}.chroma .cp{color:#999;font-weight:700;font-style:italic}.chroma .cpf{color:#999;font-weight:700;font-style:italic}.chroma .gd{color:#000;background-color:#fdd}.chroma .ge{color:#000;font-style:italic}.chroma .gr{color:#a00}.chroma .gh{color:#999}.chroma .gi{color:#000;background-color:#dfd}.chroma .go{color:#888}.chroma .gp{color:#555}.chroma .gs{font-weight:700}.chroma .gu{color:#aaa}.chroma .gt{color:#a00}.chroma .gl{text-decoration:underline}.chroma .w{color:#bbb}body{display:grid;grid-template-columns:repeat(12,1fr);grid-gap:1em 1em;font-size:1.2em;font-family:Courier New;line-height:1.5;color:#333}header .header__logo{width:100%;margin:1em 0 0}header .header__logo svg{width:100%;height:auto}header .header__logo a{border-bottom:none;box-shadow:none}header .header__logo a:hover{background:initial}header,main,footer{grid-column:3/span 7}h1,h2,h3,h4{font-family:Helvetica}h1{font-size:5rem}h2{font-size:2.5rem}h3{font-size:2rem}h4{font-size:1.5rem}a{color:inherit;text-decoration:none;border-bottom:2px dashed #37474f;transition:background .3s}a:hover{border-color:#ef8b80}li{margin-top:.25em}pre,code{font-family:lucida console,Monaco,monospace;font-size:12pt;background-color:#f1f1f1}blockquote{margin:inherit auto;margin-left:1em;padding:1em;border-left:5px solid #999}blockquote:before{display:none}blockquote:not(:first-of-type){margin-top:.5em}blockquote p{color:#555;font-size:1.25em;font-family:times new roman,serif}.under-title{display:flex;justify-content:space-between;flex-wrap:wrap;margin-top:0}.under-title__left,.under-title__right{align-self:center;margin-top:1em}#tags{margin:0;padding:0}#tags li{display:inline}.social-share amp-social-share{margin:0 .5em;border-radius:50%;background-size:60%}article>pre{overflow:auto;padding:1em}article>p>code{padding:.1em}article>.highlight{overflow:auto}article>.highlight .chroma{background-color:#f1f1f1}.post__image{max-width:1000px}table{display:block;overflow-x:auto;border-collapse:collapse}table td,table th{border:1px solid #ddd}table td{padding:.5em 1em}table th{padding:1em 2em;background-color:#ef8b80;color:#fff}table tr:nth-child(even){background-color:#f1f1f1}table tr:hover{background-color:#ddd}@media(max-width:1200px){body{grid-gap:0}main,header{grid-column:1/span 12;margin:.5em .75em 0 .5em}h1{font-size:2.5rem}h2{font-size:2rem}h3{font-size:1.66rem}h4{font-size:1.25rem}}</style><title>Metablog #6 - PWA y soporte multi-idioma</title><link href=https://asur.dev/metablogs/pwa-en-amp-con-service-worker-e-i18n/ rel=canonical><link href=https://asur.dev/sitemap.xml rel=sitemap type=application/xml><link as=script href=https://cdn.ampproject.org/v0.js rel=preload><link href=https://asur.dev/manifest.json rel=manifest><link href=https://asur.dev/icons/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link crossorigin href=https://cdn.ampproject.org rel="preconnect dns-prefetch"><link crossorigin href=https://www.googletagmanager.com rel="preconnect dns-prefetch"></head><body><amp-install-serviceworker class=i-amphtml-layout-nodisplay data-iframe-src=https://asur.dev/install-sw.html hidden=hidden i-amphtml-layout=nodisplay layout=nodisplay src=https://asur.dev/sw.js></amp-install-serviceworker><amp-analytics class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" data-credentials=include i-amphtml-layout=fixed style=width:1px;height:1px; type=gtag><script type=application/json>{"vars":{"gtag_id":"UA-128498798-1","config":{"UA-128498798-1":{"groups":"default"}}},"triggers":{"trackPageview":{"on":"visible","request":"pageview"}}}</script></amp-analytics><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/asur.dev","name":"Inicio"}},{"@type":"ListItem","position":2,"item":{"@id":"https:\/\/asur.dev\/metablogs\/","name":"Metablogs"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/asur.dev\/metablogs\/pwa-en-amp-con-service-worker-e-i18n\/","name":"Pwa en amp con service worker e i18n"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","image":"https:\/\/asur.dev\/images\/pwa-en-amp-con-service-worker-e-i18n.jpg","url":"https:\/\/asur.dev\/metablogs\/pwa-en-amp-con-service-worker-e-i18n\/","headline":"Metablog #6 - PWA y soporte multi-idioma","alternativeHeadline":"Metablog #6 - PWA y soporte multi-idioma","dateCreated":"2019-11-29T10:19:05","datePublished":"2019-11-29T10:19:05","dateModified":"2019-11-29T10:19:05","inLanguage":"es","isFamilyFriendly":"true","copyrightYear":"2019","copyrightHolder":"Asur","accountablePerson":{"@type":"Person","name":"Asur","url":"\/"},"author":{"@type":"Person","name":"Asur","url":"https:\/\/asur.dev\/"},"creator":{"@type":"Person","name":"Asur","url":"https:\/\/asur.dev\/"},"publisher":{"@type":"Organization","name":"Asur Bernardo","url":"https:\/\/asur.dev","logo":{"@type":"ImageObject","url":"\/logo-amp-article.png","width":"600","height":"60"}},"mainEntityOfPage":"https:\/\/asur.dev\/metablogs\/pwa-en-amp-con-service-worker-e-i18n\/","keywords":"[\"blog\",\"desarrollo\",\"gohugo\",\"amperage\",\"i18n\",\"amp\",\"service workers\",\"pwa\"]","genre":"[\"Evolutivo\"]","articleSection":"Los metablogs | By Asur 🧐"}</script><header><div class=header__logo><a aria-label="Volver a la página de inicio" href=https://asur.dev/ target=_top><svg height=21.13mm viewbox="0 0 204.36 21.13" width=204.36mm><g transform="translate(-2.2269 -.73219)"><g aria-label=&lt;asurbernardo/&gt; fill=#333 stroke-width=.26458><path d="m11.131 5.7223-8.9038 5.4998v1.9915l8.7996 5.4998 1.0421-1.4242-8.1744-5.0598 8.1744-5.0135z"></path><path d="m25.137 16.814v-5.8471c0-2.4083-1.5284-3.9367-4.5619-3.9367-1.181.0-2.5009.20841-3.983.76418l.50945 1.4705c1.2621-.43998 2.362-.62524 3.1725-.62524 1.8178.0 2.9062.65997 2.9062 2.4199v1.0189h-1.7947c-3.7051.0-5.7198 1.3894-5.7198 3.9019.0 2.2694 1.4936 3.763 3.9367 3.763 1.5747.0 2.9525-.57892 3.8209-1.7136.34735 1.0884 1.181 1.5747 2.2346 1.7136l.47472-1.3663c-.68313-.20841-.99575-.57892-.99575-1.5631zm-5.0366 1.4473c-1.5862.0-2.3504-.78734-2.3504-2.3041.0-1.5631.98417-2.5588 3.6704-2.5588h1.7599v3.1378c-.72944 1.0884-1.8757 1.7252-3.0799 1.7252z"></path><path d="m34.443 18.134c-1.4357.0-2.7094-.52103-3.6588-1.3199l-1.1115 1.2852c1.0421.90312 2.5704 1.6441 4.7703 1.6441 2.6052.0 5.1408-1.0305 5.1408-3.6356.0-2.281-1.5747-3.1146-3.9598-3.763-2.4662-.67155-3.242-1.0536-3.242-2.142.0-.93786.71786-1.5978 2.6399-1.5978 1.5747.0 2.6283.46314 3.543 1.0884l.85681-1.3199c-1.0189-.7526-2.4662-1.3431-4.423-1.3431-2.7557.0-4.6314 1.2736-4.6314 3.323.0 2.1189 1.621 2.883 4.1567 3.5083 2.582.64839 2.9525 1.2389 2.9525 2.3388.0 1.181-1.1578 1.9336-3.0336 1.9336z"></path><path d="m46.134 7.2854h-1.9452v8.8691c0 2.2578 1.1578 3.5893 3.5199 3.5893 1.4242.0 2.9409-.67155 3.9019-1.9104l.1621 1.6441h1.6557v-12.192h-1.9452v8.9733c-.65997 1.0421-1.9683 1.9336-3.2999 1.9336-1.4126.0-2.0494-.67155-2.0494-2.2694z"></path><path d="m66.312 7.0191c-2.2115.0-3.4388 1.1463-4.3767 3.1493l-.35893-2.883h-3.3809V8.779h1.8989v9.2049h-1.8989v1.4936h6.3218v-1.4936h-2.4778v-5.164c.81049-2.6862 2.1304-4.0061 4.0177-4.0061h.10421v2.5936h1.5978l.27788-4.1219c-.55577-.1621-1.0421-.2663-1.7252-.2663z"></path><path d="m73.915 8.8717v-6.7387l-1.9452.24315v17.101h1.702l.13894-1.2621c.82207 1.0421 1.9104 1.5284 3.323 1.5284 3.1493.0 4.8282-2.6746 4.8282-6.3682.0-3.8209-1.3084-6.345-4.5735-6.345-1.401.0-2.582.67155-3.4735 1.841zm2.7557 9.2975c-1.1115.0-2.1189-.60208-2.7557-1.5747v-6.044c.65997-.98417 1.6905-1.9568 3.0567-1.9568 1.8757.0 2.8715 1.5862 2.8715 4.7703.0 3.2535-1.1347 4.8051-3.1725 4.8051z"></path><path d="m87.389 14.07h8.1976c.02316-.2663.04631-.64839.04631-1.0652.0-3.7051-1.8757-5.9745-4.9556-5.9745-3.242.0-5.3261 2.6746-5.3261 6.3682.0 3.7862 2.0147 6.345 5.5808 6.345 1.5168.0 3.0567-.54419 4.1914-1.4357l-.9147-1.2852c-1.0768.72944-2.0147 1.1-3.2535 1.1-1.8873.0-3.462-1.2273-3.5662-4.0525zm3.3114-5.4419c1.8294.0 3.0104 1.3315 3.0567 3.9367h-6.3566c.1621-2.6862 1.482-3.9367 3.2999-3.9367z"></path><path d="m107.98 7.0191c-2.2115.0-3.4388 1.1463-4.3767 3.1493l-.35893-2.883h-3.3809V8.779h1.8989v9.2049h-1.8989v1.4936h6.3218v-1.4936h-2.4778v-5.164c.81049-2.6862 2.1304-4.0061 4.0177-4.0061h.10421v2.5936h1.5978l.27788-4.1219c-.55576-.1621-1.0421-.2663-1.7252-.2663z"></path><path d="m113.64 19.478h1.9452v-8.8807c.63681-.94943 1.8526-2.0378 3.2883-2.0378 1.841.0 2.0841 1.0073 2.0841 3.4967v7.4218h1.9452v-8.8575c0-2.2462-1.0305-3.5893-3.4272-3.5893-1.4126.0-3.0336.69471-4.0293 1.9452l-.15052-1.6905h-1.6557z"></path><path d="m136.26 16.814v-5.8471c0-2.4083-1.5284-3.9367-4.5619-3.9367-1.181.0-2.501.20841-3.983.76418l.50945 1.4705c1.262-.43998 2.362-.62524 3.1725-.62524 1.8178.0 2.9062.65997 2.9062 2.4199v1.0189h-1.7947c-3.7051.0-5.7198 1.3894-5.7198 3.9019.0 2.2694 1.4936 3.763 3.9367 3.763 1.5747.0 2.9525-.57892 3.8209-1.7136.34735 1.0884 1.181 1.5747 2.2346 1.7136l.47472-1.3663c-.68313-.20841-.99575-.57892-.99575-1.5631zm-5.0366 1.4473c-1.5862.0-2.3504-.78734-2.3504-2.3041.0-1.5631.98417-2.5588 3.6704-2.5588h1.7599v3.1378c-.72944 1.0884-1.8757 1.7252-3.0799 1.7252z"></path><path d="m149.66 7.0191c-2.2115.0-3.4388 1.1463-4.3767 3.1493l-.35893-2.883h-3.3809V8.779h1.8989v9.2049h-1.8989v1.4936h6.3218v-1.4936h-2.4778v-5.164c.81049-2.6862 2.1304-4.0061 4.0177-4.0061h.10421v2.5936h1.5978l.27788-4.1219c-.55577-.1621-1.0421-.2663-1.7252-.2663z"></path><path d="m162.61 2.133v6.3334c-.8105-.94943-1.8641-1.4357-3.2651-1.4357-3.0104.0-4.7819 2.6978-4.7819 6.3682.0 3.7746 1.4589 6.345 4.643 6.345 1.3431.0 2.5473-.57892 3.462-1.8757l.18525 1.6094h1.702v-17.101zm-2.7557 6.4608c1.1231.0 2.0957.57892 2.7557 1.5631v6.0903c-.65998.99575-1.621 1.922-2.9988 1.922-1.9104.0-2.9294-1.6094-2.9294-4.7703.0-3.2188 1.1347-4.8051 3.1725-4.8051z"></path><path d="m173.85 7.0307c-3.4388.0-5.2682 2.6052-5.2682 6.3682.0 3.8325 1.8062 6.345 5.245 6.345 3.4156.0 5.245-2.6399 5.245-6.3682.0-3.8672-1.7831-6.345-5.2219-6.345zm0 1.5862c2.0726.0 3.1378 1.5168 3.1378 4.7587s-1.0652 4.7703-3.1609 4.7703c-2.0957.0-3.1609-1.5284-3.1609-4.7472.0-3.2651 1.0884-4.7819 3.1841-4.7819z"></path><path d="m194.61 3.8466 1.1463-2.3504-1.5515-.76418-9.9112 20.436 1.5747.69471 7.9776-16.441 11.023 6.8081-8.1744 5.0482 1.0536 1.4357 8.788-5.4998v-1.9915z"></path></g></g></svg></a></div></header><main><article><h1 id=pwa-y-soporte-multi-idioma>PWA y soporte multi-idioma</h1><section class=under-title><div class=under-title__left>By Asur |
<time datetime=2019-11-29T10:19:05>29-11-2019</time><ul id=tags><li>Tags:</li> <li><a href=https://asur.dev/tags/evolutivo/ target=_top>Evolutivo</a></li></ul></div><div class="under-title__right social-share"><amp-social-share aria-label="Compartir contenido" class="social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=system width=50></amp-social-share><amp-social-share aria-label="Compartir en Facebook" class="social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=facebook width=50></amp-social-share><amp-social-share aria-label="Compartir en Twitter" class="social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=twitter width=50></amp-social-share><amp-social-share aria-label="Compartir en Linkedin" class="social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=linkedin width=50></amp-social-share><amp-social-share aria-label="Compartir en Pinterest" class="social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=pinterest width=50></amp-social-share></div></section><p>Una nueva semana, una nueva mejora! No os voy a engañar, van quedando pocas cosas que hacer además de seguir iterando en estilos y cambios pequeños, pero estos dos son muy top.</p><p>Para empezar he transformado mi web en una <strong>PWA</strong> (Progressive Web App) utilizando una librería de <strong>service workers</strong> para AMP, además he añadido soporte a mi tema Amperage para <strong>multi-idioma</strong>, traducciones y con una nueva sección en inglés incluida! 🎉</p><p><b>Tabla de contenidos:</b></p><nav id=TableOfContents><ul><li><a href=#pwa-y-soporte-multi-idioma>PWA y soporte multi-idioma</a><ul><li><a href=#convirtiendo-una-web-con-amp-en-pwa>Convirtiendo una web con AMP en PWA 🤖</a><ul><li><a href=#registrar-el-service-worker>Registrar el service worker</a></li><li><a href=#convertir-en-pwa-instalable>Convertir en PWA instalable</a></li></ul></li><li><a href=#internacionalización>Internacionalización 🌍</a><ul><li><a href=#soporte-para-traducciones>Soporte para traducciones</a></li><li><a href=#nueva-sección-en-inglés>Nueva sección en inglés</a></li></ul></li><li><a href=#siguientes-pasos>Siguientes pasos 👣</a></li><li><a href=#wayback-machine>Wayback Machine ⏰</a></li></ul></li></ul></nav><p></p><h2 id=convirtiendo-una-web-con-amp-en-pwa>Convirtiendo una web con AMP en PWA 🤖</h2><p>Hace poco puse un tweet que incluía un spoiler:</p><p><amp-twitter class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" data-tweetid=1197989534484619264 height=330 i-amphtml-layout=fixed layout=fixed style=width:390px;height:330px; width=390></amp-twitter></p><p>Después de ir a la <a href=https://2019.commit-conf.com/ target=_top>CommitConf 2019</a> este fin de semana pasado, la noche del Viernes llegué a casa con las pilas creativas recargadas y contra toda lógica me puse a hacer unas pruebas de rendimiento. Sin querer acabé posteando que mi blog ya era oficialmente una PWA! 😬</p><p>Tras investigar el tema parece que los propios creadores de AMP son fanáticos del concepto de webs progresivas, porque han creado una <a href=https://github.com/ampproject/amp-sw target=_top>librería maravillosa</a> que facilita muchísimo la parte de programar el service worker.</p><h3 id=registrar-el-service-worker>Registrar el service worker</h3><p>Bien, para empezar hay que dejar claro que por lo especialito que es AMP para con el javascript hay que hacer las cosas de una manera particular.</p><p>Por supuesto hay un componente específico para esta tarea llamado <code>amp-install-serviceworker</code>. La forma que tiene es la siguiente:</p><div class=highlight><div class=chroma><table class=lntable><tbody><tr><td class=lntd><pre class=chroma><code class=language-html data-lang=html><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>amp-install-serviceworker</span>
  <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://asur.dev/sw.js&#34;</span>
  <span class=na>data-iframe-src</span><span class=o>=</span><span class=s>&#34;https://asur.dev/install-sw.html&#34;</span>
  <span class=na>layout</span><span class=o>=</span><span class=s>&#34;nodisplay&#34;</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>amp-install-serviceworker</span><span class=p>&gt;</span></code></pre></td></tr></tbody></table></div></div><p>Tiene tres atributos, el último es autoexplicativo y el primero es donde se encuentra el javascript que instala el service worker…</p><blockquote><p>¿Entonces para que narices sirve el segundo? 😐</p></blockquote><p>Exactamente lo mismo que me pregunté yo. Pues parece que cuando se accede desde el cache de Google a una página AMP el service worker debe de ser instalado desde un iframe. De la documentación oficial:</p><blockquote><p>When the document is accessed via the Google AMP Cache, the HTML document noted in the data-iframe-src attribute is used to install the service worker. We recommend using both attributes.</p></blockquote><p>El porqué es la seguridad, <strong>los navegadores no pueden instalar service workers de dominios que no son el actual</strong>. Para más detalles os recomiendo una lectura rápida a las <a href=https://www.w3.org/TR/service-workers/#origin-restriction target=_top>especificaciones de w3.org sobre service workers</a>.</p><p>Lo más gracioso es la url del <code>data-iframe-source</code> hay que tener exactamente el mismo código que el <code>&lt;amp-install-serviceworker&gt;</code> de origen, como en <em>Inception</em>.</p><p>Para instalar el service worker he usado la librería que mencioné al principio, lo único que hay que hacer es inicializarla con la configuración que mejor se adapte a nuestro caso:</p><div class=highlight><div class=chroma><table class=lntable><tbody><tr><td class=lntd><pre class=chroma><code class=language-javascript data-lang=javascript><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-javascript data-lang=javascript><span class=nx>importScripts</span><span class=p>(</span><span class=s1>&#39;https://cdn.ampproject.org/sw/amp-sw.js&#39;</span><span class=p>);</span>

<span class=nx>AMP_SW</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
  <span class=nx>assetCachingOptions</span><span class=o>:</span> <span class=p>[{</span>
    <span class=nx>regexp</span><span class=o>:</span> <span class=sr>/\.(png|jpg|woff2|woff|css|js)/</span><span class=p>,</span>
    <span class=nx>cachingStrategy</span><span class=o>:</span> <span class=s1>&#39;CACHE_FIRST&#39;</span><span class=p>,</span>
  <span class=p>}],</span>
  <span class=nx>offlinePageOptions</span><span class=o>:</span> <span class=p>{</span>
    <span class=nx>url</span><span class=o>:</span> <span class=s1>&#39;/offline.html&#39;</span><span class=p>,</span>
    <span class=nx>assets</span><span class=o>:</span> <span class=p>[],</span>
  <span class=p>},</span>
  <span class=nx>linkPrefetchOptions</span><span class=o>:</span> <span class=p>{}</span>
<span class=p>});</span>
</code></pre></td></tr></tbody></table></div></div><p>En mi caso la única configuración que he puesto es el cacheo de assets estáticos como imágenes, fuentes, javascript y css.</p><p>Además he especificado el fichero que se mostrará cuando un usuario intente acceder offline a la aplicación y no tenga cacheada esa url en concreto. Aquí puedes ver <a href=https://asur.dev/offline.html target=_top>qué se mostraría cuando no tienes internet</a>.</p><p>Con esto el service worker ya se registra correctamente. Lo podemos confirmar con <em>Google DevTools</em>:</p><amp-img alt="Éxito instalación service worker en DevTools" class="post__image i-amphtml-layout-responsive i-amphtml-layout-size-defined" height=525 i-amphtml-layout=responsive layout=responsive src=https://asur-dev.cdn.ampproject.org/i/s/asur.dev/images/exito-instalacion-service-worker-dev-tools.jpg width=1048><i-amphtml-sizer style=display:block;padding-top:50.0954%;></i-amphtml-sizer></amp-img><p>Para probarlo definitivamente puedes desconectarte de internet y recargar la página, debería seguir apareciendo el contenido. 😄</p><p>Pero todavía el blog no es una Progressive Web App, faltan un par de cosas para que Google de su bendición, aunque lo más difícil ya está hecho!</p><h3 id=convertir-en-pwa-instalable>Convertir en PWA instalable</h3><p>El service worker ya está funcionando pero aún quedan un par de cosas por hacer para validar nuestra PWA.</p><p>La más importante es un <code>manifest.json</code> un fichero donde se almacena la información necesaria para instalar la app.</p><div class=highlight><div class=chroma><table class=lntable><tbody><tr><td class=lntd><pre class=chroma><code class=language-json data-lang=json><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Blog de Asur&#34;</span><span class=p>,</span>
  <span class=nt>&#34;short_name&#34;</span><span class=p>:</span> <span class=s2>&#34;asur.dev&#34;</span><span class=p>,</span>
  <span class=nt>&#34;start_url&#34;</span><span class=p>:</span> <span class=s2>&#34;/&#34;</span><span class=p>,</span>
  <span class=nt>&#34;display&#34;</span><span class=p>:</span> <span class=s2>&#34;standalone&#34;</span><span class=p>,</span>
  <span class=nt>&#34;background_color&#34;</span><span class=p>:</span> <span class=s2>&#34;#fff&#34;</span><span class=p>,</span>
  <span class=nt>&#34;theme_color&#34;</span><span class=p>:</span> <span class=s2>&#34;#ef8b80&#34;</span><span class=p>,</span>
  <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Bienvenid@ a mi blog, si te gusta el desarrollo web, el SEO, el open source
</span><span class=s2>    y la tecnología en general echa un vistazo, seguro que encuentras algo interesante.&#34;</span><span class=p>,</span>
  <span class=nt>&#34;icons&#34;</span><span class=p>:[{</span>
      <span class=nt>&#34;src&#34;</span><span class=p>:</span><span class=s2>&#34;/icons/android-chrome-192x192.png&#34;</span><span class=p>,</span>
      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span><span class=s2>&#34;192x192&#34;</span><span class=p>,</span>
      <span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;image/png&#34;</span>
    <span class=p>},{</span>
      <span class=nt>&#34;src&#34;</span><span class=p>:</span><span class=s2>&#34;/icons/android-chrome-512x512.png&#34;</span><span class=p>,</span>
      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span><span class=s2>&#34;512x512&#34;</span><span class=p>,</span>
      <span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;image/png&#34;</span>
  <span class=p>}]</span>
<span class=p>}</span></code></pre></td></tr></tbody></table></div></div><p>Algunos campos a destacar son:</p><ul><li><strong>name</strong>: El nombre de tu aplicación, esto aparecerá en la splash screen cuando abras la app.</li><li><strong>start_url</strong>: La url que es la home desde la que se inicia la app, suele ser <code>/</code> el 99% de las veces aunque también le podrías configurar un subdirectorio o parámetros extra para analítica.</li><li><strong>display</strong>: Como se muestra la app en el dispositivo, standalone significa que la barra de url se oculta, justo como una app nativa!</li><li><strong>background_color</strong>: El color de fondo de la splash screen.</li><li><strong>theme_color</strong>: El color de la barra de tareas de tu móvil cuando estás en la app.</li><li><strong>icons</strong>: Las imágenes centrales que aparecen en la splash screen. Se recomiendan varias resoluciones, para adaptarlas a la resolución de pantalla de cada teléfono.</li></ul><p>Ya casi estamos, ahora con linkearlo en nuestras metatags junto con los iconos de aplicación que aparecerán en android e ios estaría listo:</p><div class=highlight><div class=chroma><table class=lntable><tbody><tr><td class=lntd><pre class=chroma><code class=language-html data-lang=html><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;manifest&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;https://asur.dev/manifest.json&#34;</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;icon&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;image/png&#34;</span> <span class=na>sizes</span><span class=o>=</span><span class=s>&#34;32x32&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;https://asur.dev/icons/favicon-32x32.png&#34;</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;icon&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;image/png&#34;</span> <span class=na>sizes</span><span class=o>=</span><span class=s>&#34;16x16&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;https://asur.dev/icons/favicon-16x16.png&#34;</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;apple-touch-icon&#34;</span> <span class=na>sizes</span><span class=o>=</span><span class=s>&#34;180x180&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;https://asur.dev/icons/apple-touch-icon.png&#34;</span><span class=p>&gt;</span></code></pre></td></tr></tbody></table></div></div><p>Listo, al comprobar de nuevo en <em>DevTools Lighthouse</em> se puede ver que la página es una PWA válida:</p><amp-img alt="Éxito validación de PWA en DevTools Lighthouse" class="post__image i-amphtml-layout-responsive i-amphtml-layout-size-defined" height=845 i-amphtml-layout=responsive layout=responsive src=https://asur-dev.cdn.ampproject.org/i/s/asur.dev/images/exito-validacion-dev-tools-lighthouse.jpg srcset="https://asur-dev.cdn.ampproject.org/ii/w1000/s/asur.dev/images/exito-validacion-dev-tools-lighthouse.jpg 1000w, https://asur-dev.cdn.ampproject.org/ii/w1200/s/asur.dev/images/exito-validacion-dev-tools-lighthouse.jpg 1200w" width=924><i-amphtml-sizer style=display:block;padding-top:91.4502%;></i-amphtml-sizer></amp-img><p>Ahora cada persona que visite mi web desde un móvil puede disfrutar del maravilloso formulario de instalación.</p><p><strong>AVISO:</strong> Por supuesto, he omitido los pasos que ya tenía hechos como utilizar https, que la web sea responsive, etc.</p><h2 id=internacionalización>Internacionalización 🌍</h2><p>Siempre me ha estado rondando la idea de escribir algo en inglés, no solo por el mero hecho de practicar algo que tengo un poco oxidado, también porque para que un artículo técnico tenga una buena difusión, <em>IMHO</em>, lo ideal es que esté escrito en inglés.</p><h3 id=soporte-para-traducciones>Soporte para traducciones</h3><p>Para no empezar la casa por el tejado he hecho traducibles los literales del tema que antes estaban <em>hardcodeados</em>.</p><p>GoHugo soporta traducciones de manera nativa así que ha sido rápido de implementar.</p><p>Sustituyendo las cadenas con una función como <code>{{ i18n &#34;goBackHome&#34; }}</code> hace que al procesar el contenido Hugo busque en la ruta <code>/i18n/{laguange_code}.toml</code> por esa clave y aplique su valor.</p><div class=highlight><div class=chroma><table class=lntable><tbody><tr><td class=lntd><pre class=chroma><code class=language-toml data-lang=toml><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-toml data-lang=toml><span class=p>[</span><span class=nx>home</span><span class=p>]</span>
  <span class=nx>other</span> <span class=p>=</span> <span class=s2>&#34;Home&#34;</span>
<span class=p>[</span><span class=nx>notFound</span><span class=p>]</span>
  <span class=nx>other</span> <span class=p>=</span> <span class=s2>&#34;Page not found&#34;</span>
<span class=p>[</span><span class=nx>search</span><span class=p>]</span>
  <span class=nx>other</span> <span class=p>=</span> <span class=s2>&#34;Search&#34;</span>
<span class=p>[</span><span class=nx>goBackHome</span><span class=p>]</span>
  <span class=nx>other</span> <span class=p>=</span> <span class=s2>&#34;Go back to the homepage&#34;</span>
<span class=p>[</span><span class=nx>by</span><span class=p>]</span>
  <span class=nx>other</span> <span class=p>=</span> <span class=s2>&#34;By&#34;</span>
<span class=p>[...]</span></code></pre></td></tr></tbody></table></div></div><p>De momento solo tengo español e inglés, porque hasta ahí llego, pero por el poder del <em>open source</em> esto es fácilmente mejorable, así que si alguien se anima, ya sabéis, PR al canto en el <a href=https://github.com/asurbernardo/amperage target=_top>repositorio de Amperage</a>!</p><h3 id=nueva-sección-en-inglés>Nueva sección en inglés</h3><p>Ahora que ya hay soporte para traducciones puedo crear una nueva sección en mi web y que esta use un idioma distinto a la de por defecto.</p><p>Para eso hay que especificarla en la configuración del site:</p><div class=highlight><div class=chroma><table class=lntable><tbody><tr><td class=lntd><pre class=chroma><code class=language-toml data-lang=toml><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-toml data-lang=toml><span class=nx>theme</span> <span class=p>=</span> <span class=s2>&#34;amperage&#34;</span>
<span class=nx>DefaultContentLanguage</span> <span class=p>=</span> <span class=s2>&#34;es&#34;</span>
<span class=p>[</span><span class=nx>languages</span><span class=p>]</span>
    <span class=p>[</span><span class=nx>languages</span><span class=p>.</span><span class=nx>es</span><span class=p>]</span>
        <span class=nx>contentDir</span> <span class=p>=</span> <span class=s2>&#34;content&#34;</span>
        <span class=nx>languageName</span> <span class=p>=</span> <span class=s2>&#34;Español&#34;</span>
        <span class=nx>languageCode</span> <span class=p>=</span> <span class=s2>&#34;es&#34;</span>
        <span class=nx>title</span> <span class=p>=</span> <span class=s2>&#34;Bienvenid@ a mi blog | By Asur 🧐&#34;</span>
        <span class=nx>description</span> <span class=p>=</span> <span class=s2>&#34;Bienvenid@ a mi blog, si te gusta el desarrollo web, el SEO, el open source
</span><span class=s2>          y la tecnología en general echa un vistazo, seguro que encuentras algo interesante.&#34;</span>
        <span class=nx>weight</span> <span class=p>=</span> <span class=mi>1</span>
    <span class=p>[</span><span class=nx>languages</span><span class=p>.</span><span class=nx>en</span><span class=p>]</span>
        <span class=nx>contentDir</span> <span class=p>=</span> <span class=s2>&#34;content/english&#34;</span>
        <span class=nx>languageName</span> <span class=p>=</span> <span class=s2>&#34;English&#34;</span>
        <span class=nx>languageCode</span> <span class=p>=</span> <span class=s2>&#34;en&#34;</span>
        <span class=nx>title</span> <span class=p>=</span> <span class=s2>&#34;Welcome to my blog | By Asur 🧐&#34;</span>
        <span class=nx>description</span> <span class=p>=</span> <span class=s2>&#34;This is the English section of my site. It&#39;s still a 
</span><span class=s2>          work in progress but news are coming! Stay tuned!&#34;</span>
        <span class=nx>weight</span> <span class=p>=</span> <span class=mi>2</span></code></pre></td></tr></tbody></table></div></div><p>Ahora cada idioma tiene una sección separada con sus propios parámetros, y a su vez estos hacen fallback a los genéricos con la misma clave.</p><p>Sé que algún amigo del SEO que lea esto va a entrar en parada diciendo:</p><blockquote><p>Pe-pe-pero no tienes la etiqueta hreflang! 😵</p></blockquote><p>Si, lo sé, es que las etiquetas como <code>&lt;link rel=&#34;alternate&#34; href=&#34;https://example.com/es&#34; hreflang=&#34;es&#34; /&gt;</code> se utilizan para especificar páginas que son una <strong>alternativa directa</strong> en otro idioma, no se puede usar para páginas con contenidos distintos.</p><p>Quizás el único punto en el que esto tendría sentido es en ambas homepages pero de momento lo he dejado correr, me conformo con el <code>&lt;html ⚡ lang=&#34;en&#34;&gt;</code>.</p><p>Ah si! El link? <a href=https://asur.dev/en target=_top>Aquí podéis ver la sección en inglés</a>.</p><h2 id=siguientes-pasos>Siguientes pasos 👣</h2><p>Aprovechando la nueva sección en inglés creo que la voy a escribir mi primer post en otro idioma, ya tengo una idea bastante aterrizada de que puede tratar y es la leche, pero vais a tener que esperar para verlo, <em>stay tuned!</em> 😜</p><h2 id=wayback-machine>Wayback Machine ⏰</h2><p>Ver la <a href=https://web.archive.org/web/20191202111737/https://asur.dev/metablogs/pwa-en-amp-con-service-worker-e-i18n/ target=_top title="Versión original del post">versión original de este post</a>.</p><p>Ver la <a href=https://web.archive.org/web/20191202111805/https://asur.dev/en/ target=_top title="Versión original de la sección en inglés">versión original de la sección en inglés</a>.</p><h2>Lecturas relacionadas 📖</h2><p><a href=https://asur.dev/metablogs/nuevo-dominio-legibilidad-integracion-amp-scripts/ target=_top>Metablog #4 - Nuevo dominio, nuevo layout y más AMP!</a></p><p><a href=https://asur.dev/metablogs/mejorando-workflow-docker-makefile-github-actions/ target=_top>Metablog #3 - Workflow con docker, makefile y Github actions</a></p><p><a href=https://asur.dev/metablogs/la-primera-iteracion-amp-estilos-y-miscelanea/ target=_top>Metablog #1 - AMP, estilos y otras miscelaneas</a></p><h2>Deja un comentario! 💬</h2><amp-script class=i-amphtml-layout-container i-amphtml-layout=container layout=container sandbox="allow-forms allow-popups" src=https://cdn.commento.io/js/commento.js><div id=commento></div></amp-script></article></main><footer><div class=footer__copyright>© asur.dev 2019</div></footer></body></html>
