<!doctype html><html i-amphtml-layout i-amphtml-no-boilerplate lang=es transformed="google;v=2" ⚡><head><meta charset=utf-8><style amp-runtime i-amphtml-version=latest></style><meta content="width=device-width,minimum-scale=1,initial-scale=1" name=viewport><meta content="Creo una PWA en AMP utilizando service workers para poder instalarla en tu móvil y accder offline, además añado i18n con una nueva sección en inglés!" name=description><meta content="Metablog #6 - PWA y soporte multi-idioma" property=og:title><meta content=https://asur.dev/metablogs/pwa-en-amp-con-service-worker-e-i18n/ property=og:url><meta content="Creo una PWA en AMP utilizando service workers para poder instalarla en tu móvil y accder offline, además añado i18n con una nueva sección en inglés!" property=og:description><meta content=https://asur.dev/images/pwa-en-amp-con-service-worker-e-i18n/share-card.jpg property=og:image><meta content=article property=og:type><meta content property=og:site_name><meta content=summary_large_image name=twitter:card><meta content="Metablog #6 - PWA y soporte multi-idioma" name=twitter:title><meta content=https://asur.dev/metablogs/pwa-en-amp-con-service-worker-e-i18n/ name=twitter:url><meta content="Creo una PWA en AMP utilizando service workers para poder instalarla en tu móvil y accder offline, además añado i18n con una nueva sección en inglés!" name=twitter:description><meta content=https://asur.dev/images/pwa-en-amp-con-service-worker-e-i18n/share-card.jpg name=twitter:image><meta content=@asurbernardo name=twitter:site><meta content=#333 name=theme-color><script async src=https://cdn.ampproject.org/v0.js></script><script async custom-element=amp-analytics src=https://cdn.ampproject.org/v0/amp-analytics-0.1.js></script><script async custom-element=amp-iframe src=https://cdn.ampproject.org/v0/amp-iframe-0.1.js></script><script async custom-element=amp-install-serviceworker src=https://cdn.ampproject.org/v0/amp-install-serviceworker-0.1.js></script><script async custom-element=amp-social-share src=https://cdn.ampproject.org/v0/amp-social-share-0.1.js></script><script async custom-element=amp-twitter src=https://cdn.ampproject.org/v0/amp-twitter-0.1.js></script><link href=https://asur-dev.cdn.ampproject.org/i/s/asur.dev/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=https://asur-dev.cdn.ampproject.org/i/s/asur.dev/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href rel="dns-prefetch preconnect"><link href=https://asur-dev.cdn.ampproject.org rel="dns-prefetch preconnect"><style amp-custom>*,*::before,*::after{box-sizing:border-box}ul[class],ol[class]{padding:0}body,h1,h2,h3,h4,p,ul[class],ol[class],li,figure,figcaption,blockquote,dl,dd{margin:0}body{min-height:100vh;scroll-behavior:smooth;text-rendering:optimizeSpeed}ul[class],ol[class]{list-style:none}a:not([class]){text-decoration-skip-ink:auto}img{max-width:100%;display:block}input,button,textarea,select{font:inherit}.chroma{background-color:#fff}.chroma .err{color:#a61717;background-color:#e3d2d2}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block}.chroma .hl{display:block;width:100%;background-color:#ffc}.chroma .lnt{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .ln{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .k{color:#000;font-weight:700}.chroma .kc{color:#000;font-weight:700}.chroma .kd{color:#000;font-weight:700}.chroma .kn{color:#000;font-weight:700}.chroma .kp{color:#000;font-weight:700}.chroma .kr{color:#000;font-weight:700}.chroma .kt{color:#458;font-weight:700}.chroma .na{color:teal}.chroma .nb{color:#0086b3}.chroma .bp{color:#999}.chroma .nc{color:#458;font-weight:700}.chroma .no{color:teal}.chroma .nd{color:#3c5d5d;font-weight:700}.chroma .ni{color:purple}.chroma .ne{color:#900;font-weight:700}.chroma .nf{color:#900;font-weight:700}.chroma .nl{color:#900;font-weight:700}.chroma .nn{color:#555}.chroma .nt{color:navy}.chroma .nv{color:teal}.chroma .vc{color:teal}.chroma .vg{color:teal}.chroma .vi{color:teal}.chroma .s{color:#d14}.chroma .sa{color:#d14}.chroma .sb{color:#d14}.chroma .sc{color:#d14}.chroma .dl{color:#d14}.chroma .sd{color:#d14}.chroma .s2{color:#d14}.chroma .se{color:#d14}.chroma .sh{color:#d14}.chroma .si{color:#d14}.chroma .sx{color:#d14}.chroma .sr{color:#009926}.chroma .s1{color:#d14}.chroma .ss{color:#990073}.chroma .m{color:#099}.chroma .mb{color:#099}.chroma .mf{color:#099}.chroma .mh{color:#099}.chroma .mi{color:#099}.chroma .il{color:#099}.chroma .mo{color:#099}.chroma .o{color:#000;font-weight:700}.chroma .ow{color:#000;font-weight:700}.chroma .c{color:#998;font-style:italic}.chroma .ch{color:#998;font-style:italic}.chroma .cm{color:#998;font-style:italic}.chroma .c1{color:#998;font-style:italic}.chroma .cs{color:#999;font-weight:700;font-style:italic}.chroma .cp{color:#999;font-weight:700;font-style:italic}.chroma .cpf{color:#999;font-weight:700;font-style:italic}.chroma .gd{color:#000;background-color:#fdd}.chroma .ge{color:#000;font-style:italic}.chroma .gr{color:#a00}.chroma .gh{color:#999}.chroma .gi{color:#000;background-color:#dfd}.chroma .go{color:#888}.chroma .gp{color:#555}.chroma .gs{font-weight:700}.chroma .gu{color:#aaa}.chroma .gt{color:#a00}.chroma .gl{text-decoration:underline}.chroma .w{color:#bbb}body{display:grid;grid-template-columns:repeat(12,1fr);grid-gap:1em 1em;font-size:1.2em;font-family:Courier New;line-height:1.6;color:#000}.header,.main,.footer{grid-column:4/span 6}.header{margin-top:1em}.header__menu{margin:0;padding:0;display:flex;overflow:auto;justify-content:flex-start;border:1px solid #333}.header__menu a{font-size:1.2em;white-space:nowrap;border-bottom:none}.header__menu a:hover{color:#d14}.header__menu__logo{line-height:0}.header__menu__logo svg{width:75px;height:75px;min-width:75px;min-height:75px}.header__menu__list{display:flex;flex-grow:1;flex-wrap:nowrap;align-items:center;justify-content:space-around}.header__menu__list li{padding:0 1em;display:inline}.main{min-width:0;min-height:80vh}.main .pagination{margin:3em auto 2em;display:flex;justify-content:space-between}.footer{display:flex;justify-content:space-between;flex-wrap:wrap}h1{font-size:3.5rem}h2{font-size:2.5rem}h3{font-size:2rem}h4{font-size:1.5rem}a{color:inherit;text-decoration:none;transition:background .3s;border-bottom:2px dashed #37474f}a:hover{border-color:#d14}.button{padding:.5em .75em;font-size:1.2em;text-align:center;border:1px solid #000;box-shadow:7px 7px 0 0 #333}.button:hover{color:#d14;border:1px solid #000;transform:translate(4px,4px);box-shadow:3px 3px 0 0 #333}li{margin-top:.25em}pre,code{font-family:lucida console,Monaco,monospace;font-size:12pt;background-color:#f1f1f1}blockquote{margin:inherit auto;margin-left:1em;padding:1em;border-left:5px solid #999}blockquote:before{display:none}blockquote:not(:first-of-type){margin-top:.5em}blockquote p{color:#555;font-size:1.25em;font-family:times new roman,serif}.figure{width:100%;max-width:100%}.figure--with-caption{display:flex;border-top:6px solid #333}.figure__image--with-caption{min-width:70%}.figure__caption{background-color:#333;color:#fff;font-weight:700;padding:.5em 1em;height:min-content;word-wrap:break-word}.post-it{width:100%;padding:1.5em}.post-it--tip{background-color:#fffacd}.post-it--info{background-color:azure}.post-it--danger{background-color:#ffcccb}.post-it--success{background-color:#d0f0c0}.post-it__title{font-weight:700;font-size:1.5em}.product{width:100%;display:flex;justify-content:space-between;padding:1.5em;border:1px solid #333}.product__image{margin:auto;width:100%;min-width:250px;max-width:400px}.product__content{margin-left:2em;align-self:center;display:flex;flex-direction:column}.product__title{font-weight:700;font-size:1.5rem}.product__description{margin-top:1em}.product__cta{margin-top:1em}.social-share{display:flex;align-self:center;align-items:center}.social-share__button{margin:0 .5em;border-radius:50%;background-size:60%}#tags{margin:0;padding:0}#tags li{display:inline}.content{width:100%}.content>*{margin-top:1.5em}.content>h1{margin-top:.5em}.content pre{overflow:auto;padding:.5em}.content code{padding:.1em}.content table{display:block;overflow-x:auto;border-collapse:collapse}.content table td,.content table th{border:1px solid #ddd}.content table td{padding:.5em 1em}.content table th{padding:1em 2em;background-color:#333;color:#fff}.content table tr:nth-child(even){background-color:#f1f1f1}.content table tr:hover{background-color:#ddd}.content .highlight .chroma{background-color:#f1f1f1}.content .under-title{display:flex;flex-wrap:wrap;justify-content:space-between;font-size:1rem}.content .under-title__info,.content .under-title__social-share{align-self:center}.content .ad{display:flex;margin:1rem auto;align-content:center;width:min-content;height:min-content;min-width:320px;min-height:320px;border:1px solid #333}.content .ad__fallback{display:flex;align-items:center}.content .ad__fallback p{margin:auto}.content .author{display:flex;flex-direction:column;align-items:center;background-color:#f1f1f1;padding:1.5rem}.content .author>*:not(:first-child){margin-top:1rem}.content .author__name{font-weight:700;font-size:1.5em}.content .author__image{border-radius:100px}.content .author__bio{text-align:center}.content .author__cta{font-size:1.25em}.summary:not(:first-of-type) h2{margin-top:2.5em}.summary>*{margin-top:1.25em}.summary__title{text-align:center}.summary .button{display:block;margin:inherit 1em}@media(max-width:1200px){body{grid-gap:0}.main,.header,.footer{grid-column:1/span 12}.main,.footer{margin:1em .75em 0 .5em}.header{margin:0}.header__menu{border:none;border-bottom:1px solid #333}h1{font-size:2.5rem}h2{font-size:2rem}h3{font-size:1.66rem}h4{font-size:1.25rem}.post-it{margin-left:0;margin-right:0}}@media(max-width:600px){.under-title__social-share{width:100%;margin-top:1.5em;justify-content:space-between}.figure{flex-direction:column-reverse}.figure--with-caption{border-top:none}.figure__caption{position:relative;max-width:100%}.product{flex-wrap:wrap}.product__content{margin-left:unset;text-align:center}.product__title{margin-top:1em}}</style><title>Metablog #6 - PWA y soporte multi-idioma</title><link href=https://asur.dev/metablogs/pwa-en-amp-con-service-worker-e-i18n/ rel=canonical><link href=https://asur.dev/sitemap.xml rel=sitemap type=application/xml><link href=https://asur.dev/manifest.json rel=manifest><link href=https://asur.dev/icons/apple-touch-icon.png rel=apple-touch-icon sizes=180x180></head><body><amp-install-serviceworker class=i-amphtml-layout-nodisplay data-iframe-src=https://asur.dev/install-sw.html hidden=hidden i-amphtml-layout=nodisplay layout=nodisplay src=https://asur.dev/sw.js></amp-install-serviceworker><amp-analytics class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" data-credentials=include i-amphtml-layout=fixed style=width:1px;height:1px; type=gtag><script type=application/json>{"vars":{"gtag_id":"UA-128498798-1","config":{"UA-128498798-1":{"groups":"default"}}},"triggers":{"trackPageview":{"on":"visible","request":"pageview"}}}</script></amp-analytics><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/asur.dev","name":"Inicio"}},{"@type":"ListItem","position":2,"item":{"@id":"https:\/\/asur.dev\/metablogs\/","name":"Metablogs"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/asur.dev\/metablogs\/pwa-en-amp-con-service-worker-e-i18n\/","name":"Pwa en amp con service worker e i18n"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","image":"https:\/\/asur.dev\/images\/pwa-en-amp-con-service-worker-e-i18n\/share-card.jpg","url":"https:\/\/asur.dev\/metablogs\/pwa-en-amp-con-service-worker-e-i18n\/","headline":"Metablog #6 - PWA y soporte multi-idioma","alternativeHeadline":"Metablog #6 - PWA y soporte multi-idioma","dateCreated":"2019-11-29T10:19:05","datePublished":"2019-11-29T10:19:05","dateModified":"2019-11-29T10:19:05","inLanguage":"es","isFamilyFriendly":"true","copyrightYear":"2019","copyrightHolder":"Asur Bernardo","accountablePerson":{"@type":"Person","name":"Asur Bernardo","url":"\/"},"author":{"@type":"Person","name":"Asur Bernardo","url":"https:\/\/asur.dev\/","image":"https:\/\/asur.dev\/images\/me.jpg","description":"Back end developer sin ningún tipo de gusto estético. Me encanta el cacharreo y la tecnología. Siempre intento aprender cosas nuevas."},"creator":{"@type":"Person","name":"Asur Bernardo","url":"https:\/\/asur.dev\/","image":"https:\/\/asur.dev\/images\/me.jpg","description":"Back end developer sin ningún tipo de gusto estético. Me encanta el cacharreo y la tecnología. Siempre intento aprender cosas nuevas."},"publisher":{"@type":"Organization","name":"Asur Bernardo","url":"https:\/\/asur.dev","logo":{"@type":"ImageObject","url":"\/logo-amp-article.png","width":"600","height":"60"}},"mainEntityOfPage":"https:\/\/asur.dev\/metablogs\/pwa-en-amp-con-service-worker-e-i18n\/","keywords":"[\"blog\",\"desarrollo\",\"gohugo\",\"amperage\",\"i18n\",\"amp\",\"service workers\",\"pwa\"]","genre":"[\"Evolutivo\"]","articleSection":"Los metablogs | By Asur 🧐"}</script><header class=header><nav class=header__menu><a aria-label="Volver a la página de inicio" class=header__menu__logo data-rel=prefetch href=https://asur.dev target=_top><svg viewbox="0 0 39.687 39.688"><g transform="translate(0 -257.31)"><rect fill=#333 height=44.507 stroke-width=.26458 width=46.68 x=-4.7247 y=254.1></rect><g aria-label=a/ fill=#fff stroke-width=.47195 transform="matrix(.95987 0 0 .99672 -.00047323 11.993)"><path d="m16.898 272.93v-7.3088c0-3.0104-1.9104-4.9208-5.7023-4.9208-1.4762.0-3.1262.26052-4.9787.95522l.63681 1.8381c1.5775-.54997 2.9525-.78154 3.9656-.78154 2.2723.0 3.6327.82496 3.6327 3.0248v1.2736h-2.2433c-4.6313.0-7.1496 1.7368-7.1496 4.8774.0 2.8367 1.867 4.7037 4.9208 4.7037 1.9683.0 3.6906-.72365 4.7761-2.142.43419 1.3605 1.4762 1.9683 2.7933 2.142l.59339-1.7078c-.8539-.26051-1.2447-.72365-1.2447-1.9538zm-6.2957 1.8091c-1.9828.0-2.938-.98416-2.938-2.8801.0-1.9538 1.2302-3.1985 4.5879-3.1985h2.1999v3.9222c-.91179 1.3605-2.3446 2.1565-3.8498 2.1565z" style=font-feature-settings:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal></path><path d="m23.928 279.24 12.36-25.458-1.9394-.95521-12.389 25.545z" style=font-feature-settings:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal></path></g></g></svg></a><ul class=header__menu__list><li><a href=https://github.com/asurbernardo rel="nofollow noopener noreferrer" target=_blank><span>GitHub</span></a></li><li><a href=https://twitter.com/asurbernardo rel="nofollow noopener noreferrer" target=_blank><span>Twitter</span></a></li><li><a data-rel=prefetch href=https://asur.dev/uses target=_top><span>/Uses</span></a></li><li><a data-rel=prefetch href=https://asur.dev/support target=_top><span>Apóyame</span></a></li></ul></nav></header><main class=main><article class=content><h1 id=pwa-y-soporte-multi-idioma>PWA y soporte multi-idioma</h1><section class=under-title><div class=under-title__info><time datetime=2019-11-29T10:19:05>29 de Noviembre 2019</time>
por Asur Bernardo<ul id=tags><li>Tags:</li> <li><a data-rel=prefetch href=https://asur.dev/tags/evolutivo/ target=_top>Evolutivo</a></li></ul></div><div class="under-title__social-share social-share"><amp-social-share aria-label="Compartir contenido" class="social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=system width=50></amp-social-share><amp-social-share aria-label="Compartir en Facebook" class="social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=facebook width=50></amp-social-share><amp-social-share aria-label="Compartir en Twitter" class="social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=twitter width=50></amp-social-share><amp-social-share aria-label="Compartir en Linkedin" class="social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=linkedin width=50></amp-social-share><amp-social-share aria-label="Compartir en Pinterest" class="social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=pinterest width=50></amp-social-share></div></section><p>Una nueva semana, una nueva mejora! No os voy a engañar, van quedando pocas cosas que hacer además de seguir iterando en estilos y cambios pequeños, pero estos dos son muy top.</p><p>Para empezar he transformado mi web en una <strong>PWA</strong> (Progressive Web App) utilizando una librería de <strong>service workers</strong> para AMP, además he añadido soporte a mi tema Amperage para <strong>multi-idioma</strong>, traducciones y con una nueva sección en inglés incluida! 🎉</p><p><b>Tabla de contenidos:</b></p><nav id=TableOfContents><ul><li><a href=#pwa-y-soporte-multi-idioma>PWA y soporte multi-idioma</a><ul><li><a href=#convirtiendo-una-web-con-amp-en-pwa>Convirtiendo una web con AMP en PWA 🤖</a><ul><li><a href=#registrar-el-service-worker>Registrar el service worker</a></li><li><a href=#convertir-en-pwa-instalable>Convertir en PWA instalable</a></li></ul></li><li><a href=#internacionalización>Internacionalización 🌍</a><ul><li><a href=#soporte-para-traducciones>Soporte para traducciones</a></li><li><a href=#nueva-sección-en-inglés>Nueva sección en inglés</a></li></ul></li><li><a href=#siguientes-pasos>Siguientes pasos 👣</a></li><li><a href=#wayback-machine>Wayback Machine ⏰</a></li></ul></li></ul></nav><p></p><h2 id=convirtiendo-una-web-con-amp-en-pwa>Convirtiendo una web con AMP en PWA 🤖</h2><p>Hace poco puse un tweet que incluía un spoiler:</p><p><amp-twitter class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" data-tweetid=1197989534484619264 height=330 i-amphtml-layout=fixed layout=fixed style=width:390px;height:330px; width=390></amp-twitter></p><p>Después de ir a la <a href=https://2019.commit-conf.com/ target=_top>CommitConf 2019</a> este fin de semana pasado, la noche del Viernes llegué a casa con las pilas creativas recargadas y contra toda lógica me puse a hacer unas pruebas de rendimiento. Sin querer acabé posteando que mi blog ya era oficialmente una PWA! 😬</p><p>Tras investigar el tema parece que los propios creadores de AMP son fanáticos del concepto de webs progresivas, porque han creado una <a href=https://github.com/ampproject/amp-sw target=_top>librería maravillosa</a> que facilita muchísimo la parte de programar el service worker.</p><h3 id=registrar-el-service-worker>Registrar el service worker</h3><p>Bien, para empezar hay que dejar claro que por lo especialito que es AMP para con el javascript hay que hacer las cosas de una manera particular.</p><p>Por supuesto hay un componente específico para esta tarea llamado <code>amp-install-serviceworker</code>. La forma que tiene es la siguiente:</p><div class=highlight><div class=chroma><table class=lntable><tbody><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>amp-install-serviceworker</span>
  <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://asur.dev/sw.js&#34;</span>
  <span class=na>data-iframe-src</span><span class=o>=</span><span class=s>&#34;https://asur.dev/install-sw.html&#34;</span>
  <span class=na>layout</span><span class=o>=</span><span class=s>&#34;nodisplay&#34;</span><span class=p></span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=p>/</span><span class=nt>amp-install-serviceworker</span><span class=p>&gt;</span></code></pre></td></tr></tbody></table></div></div><p>Tiene tres atributos, el último es autoexplicativo y el primero es donde se encuentra el javascript que instala el service worker…</p><blockquote><p>¿Entonces para que narices sirve el segundo? 😐</p></blockquote><p>Exactamente lo mismo que me pregunté yo. Pues parece que cuando se accede desde el cache de Google a una página AMP el service worker debe de ser instalado desde un iframe. De la documentación oficial:</p><blockquote><p>When the document is accessed via the Google AMP Cache, the HTML document noted in the data-iframe-src attribute is used to install the service worker. We recommend using both attributes.</p></blockquote><p>El porqué es la seguridad, <strong>los navegadores no pueden instalar service workers de dominios que no son el actual</strong>. Para más detalles os recomiendo una lectura rápida a las <a href=https://www.w3.org/TR/service-workers/#origin-restriction target=_top>especificaciones de w3.org sobre service workers</a>.</p><p>Lo más gracioso es la url del <code>data-iframe-source</code> hay que tener exactamente el mismo código que el <code>&lt;amp-install-serviceworker&gt;</code> de origen, como en <em>Inception</em>.</p><p>Para instalar el service worker he usado la librería que mencioné al principio, lo único que hay que hacer es inicializarla con la configuración que mejor se adapte a nuestro caso:</p><div class=highlight><div class=chroma><table class=lntable><tbody><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-javascript data-lang=javascript><span class=nx>importScripts</span><span class=p>(</span><span class=s1>&#39;https://cdn.ampproject.org/sw/amp-sw.js&#39;</span><span class=p>)</span><span class=p>;</span>

<span class=nx>AMP_SW</span><span class=p>.</span><span class=nx>init</span><span class=p>(</span><span class=p>{</span>
  <span class=nx>assetCachingOptions</span><span class=o>:</span> <span class=p>[</span><span class=p>{</span>
    <span class=nx>regexp</span><span class=o>:</span> <span class=sr>/\.(png|jpg|woff2|woff|css|js)/</span><span class=p>,</span>
    <span class=nx>cachingStrategy</span><span class=o>:</span> <span class=s1>&#39;CACHE_FIRST&#39;</span><span class=p>,</span>
  <span class=p>}</span><span class=p>]</span><span class=p>,</span>
  <span class=nx>offlinePageOptions</span><span class=o>:</span> <span class=p>{</span>
    <span class=nx>url</span><span class=o>:</span> <span class=s1>&#39;/offline.html&#39;</span><span class=p>,</span>
    <span class=nx>assets</span><span class=o>:</span> <span class=p>[</span><span class=p>]</span><span class=p>,</span>
  <span class=p>}</span><span class=p>,</span>
  <span class=nx>linkPrefetchOptions</span><span class=o>:</span> <span class=p>{</span><span class=p>}</span>
<span class=p>}</span><span class=p>)</span><span class=p>;</span>
</code></pre></td></tr></tbody></table></div></div><p>En mi caso la única configuración que he puesto es el cacheo de assets estáticos como imágenes, fuentes, javascript, css, etc y el <em>prefetch</em> de los links de la página para una navegación instantanea.</p><p>Además he especificado el fichero que se mostrará cuando un usuario intente acceder offline a la aplicación y no tenga cacheada esa url en concreto. Aquí puedes ver <a href=https://asur.dev/offline.html target=_top>qué se mostraría cuando no tienes internet</a>.</p><p>Con esto el service worker ya se registra correctamente. Lo podemos confirmar con <em>Google DevTools</em>:</p><figure class=figure><amp-img alt="Éxito instalación service worker en DevTools" class="figure__image i-amphtml-layout-responsive i-amphtml-layout-size-defined" height=525 i-amphtml-layout=responsive layout=responsive src=https://asur-dev.cdn.ampproject.org/i/s/asur.dev/images/pwa-en-amp-con-service-worker-e-i18n/exito-instalacion-service-worker-dev-tools.jpg width=1048><i-amphtml-sizer style=display:block;padding-top:50.0954%;></i-amphtml-sizer></amp-img></figure><p>Para probarlo definitivamente puedes desconectarte de internet y recargar la página, debería seguir apareciendo el contenido. 😄</p><p>Pero todavía el blog no es una Progressive Web App, faltan un par de cosas para que Google de su bendición, aunque lo más difícil ya está hecho!</p><h3 id=convertir-en-pwa-instalable>Convertir en PWA instalable</h3><p>El service worker ya está funcionando pero aún quedan un par de cosas por hacer para validar nuestra PWA.</p><p>La más importante es un <code>manifest.json</code> un fichero donde se almacena la información necesaria para instalar la app.</p><div class=highlight><div class=chroma><table class=lntable><tbody><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Blog de Asur&#34;</span><span class=p>,</span>
  <span class=nt>&#34;short_name&#34;</span><span class=p>:</span> <span class=s2>&#34;asur.dev&#34;</span><span class=p>,</span>
  <span class=nt>&#34;start_url&#34;</span><span class=p>:</span> <span class=s2>&#34;/&#34;</span><span class=p>,</span>
  <span class=nt>&#34;display&#34;</span><span class=p>:</span> <span class=s2>&#34;standalone&#34;</span><span class=p>,</span>
  <span class=nt>&#34;background_color&#34;</span><span class=p>:</span> <span class=s2>&#34;#fff&#34;</span><span class=p>,</span>
  <span class=nt>&#34;theme_color&#34;</span><span class=p>:</span> <span class=s2>&#34;#ef8b80&#34;</span><span class=p>,</span>
  <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Bienvenid@ a mi blog, si te gusta el desarrollo web, el SEO, el open source
</span><span class=s2>    y la tecnología en general echa un vistazo, seguro que encuentras algo interesante.&#34;</span><span class=p>,</span>
  <span class=nt>&#34;icons&#34;</span><span class=p>:</span><span class=p>[</span><span class=p>{</span>
      <span class=nt>&#34;src&#34;</span><span class=p>:</span><span class=s2>&#34;/icons/android-chrome-192x192.png&#34;</span><span class=p>,</span>
      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span><span class=s2>&#34;192x192&#34;</span><span class=p>,</span>
      <span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;image/png&#34;</span>
    <span class=p>}</span><span class=p>,</span><span class=p>{</span>
      <span class=nt>&#34;src&#34;</span><span class=p>:</span><span class=s2>&#34;/icons/android-chrome-512x512.png&#34;</span><span class=p>,</span>
      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span><span class=s2>&#34;512x512&#34;</span><span class=p>,</span>
      <span class=nt>&#34;type&#34;</span><span class=p>:</span><span class=s2>&#34;image/png&#34;</span>
  <span class=p>}</span><span class=p>]</span>
<span class=p>}</span></code></pre></td></tr></tbody></table></div></div><p>Algunos campos a destacar son:</p><ul><li><strong>name</strong>: El nombre de tu aplicación, esto aparecerá en la splash screen cuando abras la app.</li><li><strong>start_url</strong>: La url que es la home desde la que se inicia la app, suele ser <code>/</code> el 99% de las veces aunque también le podrías configurar un subdirectorio o parámetros extra para analítica.</li><li><strong>display</strong>: Como se muestra la app en el dispositivo, standalone significa que la barra de url se oculta, justo como una app nativa!</li><li><strong>background_color</strong>: El color de fondo de la splash screen.</li><li><strong>theme_color</strong>: El color de la barra de tareas de tu móvil cuando estás en la app.</li><li><strong>icons</strong>: Las imágenes centrales que aparecen en la splash screen. Se recomiendan varias resoluciones, para adaptarlas a la resolución de pantalla de cada teléfono.</li></ul><p>Ya casi estamos, ahora con linkearlo en nuestras metatags junto con los iconos de aplicación que aparecerán en android e ios estaría listo:</p><div class=highlight><div class=chroma><table class=lntable><tbody><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;manifest&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;https://asur.dev/manifest.json&#34;</span><span class=p></span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;icon&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;image/png&#34;</span>
    <span class=na>sizes</span><span class=o>=</span><span class=s>&#34;32x32&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;https://asur.dev/icons/favicon-32x32.png&#34;</span><span class=p></span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;icon&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;image/png&#34;</span>
    <span class=na>sizes</span><span class=o>=</span><span class=s>&#34;16x16&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;https://asur.dev/icons/favicon-16x16.png&#34;</span><span class=p></span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;apple-touch-icon&#34;</span>
    <span class=na>sizes</span><span class=o>=</span><span class=s>&#34;180x180&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;https://asur.dev/icons/apple-touch-icon.png&#34;</span><span class=p></span><span class=p>&gt;</span></code></pre></td></tr></tbody></table></div></div><p>Listo, al comprobar de nuevo en <em>DevTools Lighthouse</em> se puede ver que la página es una PWA válida:</p><figure class=figure><amp-img alt="Éxito validación de PWA en DevTools Lighthouse" class="figure__image i-amphtml-layout-responsive i-amphtml-layout-size-defined" height=895 i-amphtml-layout=responsive layout=responsive src=https://asur-dev.cdn.ampproject.org/i/s/asur.dev/images/pwa-en-amp-con-service-worker-e-i18n/exito-validacion-dev-tools-lighthouse.jpg srcset="https://asur-dev.cdn.ampproject.org/ii/w1000/s/asur.dev/images/pwa-en-amp-con-service-worker-e-i18n/exito-validacion-dev-tools-lighthouse.jpg 1000w, https://asur-dev.cdn.ampproject.org/ii/w1200/s/asur.dev/images/pwa-en-amp-con-service-worker-e-i18n/exito-validacion-dev-tools-lighthouse.jpg 1200w" width=924><i-amphtml-sizer style=display:block;padding-top:96.8615%;></i-amphtml-sizer></amp-img></figure><p>Ahora cada persona que visite mi web desde un móvil puede disfrutar del maravilloso formulario de instalación.</p><p><strong>AVISO:</strong> Por supuesto, he omitido los pasos que ya tenía hechos como utilizar https, que la web sea responsive, etc.</p><h2 id=internacionalización>Internacionalización 🌍</h2><p>Siempre me ha estado rondando la idea de escribir algo en inglés, no solo por el mero hecho de practicar algo que tengo un poco oxidado, también porque para que un artículo técnico tenga una buena difusión, <em>IMHO</em>, lo ideal es que esté escrito en inglés.</p><h3 id=soporte-para-traducciones>Soporte para traducciones</h3><p>Para no empezar la casa por el tejado he hecho traducibles los literales del tema que antes estaban <em>hardcodeados</em>.</p><p>GoHugo soporta traducciones de manera nativa así que ha sido rápido de implementar.</p><p>Sustituyendo las cadenas con una función como <code>{{ i18n &#34;goBackHome&#34; }}</code> hace que al procesar el contenido Hugo busque en la ruta <code>/i18n/{laguange_code}.toml</code> por esa clave y aplique su valor.</p><div class=highlight><div class=chroma><table class=lntable><tbody><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-toml data-lang=toml><span class=p>[</span><span class=nx>home</span><span class=p>]</span>
  <span class=nx>other</span> <span class=p>=</span> <span class=s2>&#34;Home&#34;</span>
<span class=p>[</span><span class=nx>notFound</span><span class=p>]</span>
  <span class=nx>other</span> <span class=p>=</span> <span class=s2>&#34;Page not found&#34;</span>
<span class=p>[</span><span class=nx>search</span><span class=p>]</span>
  <span class=nx>other</span> <span class=p>=</span> <span class=s2>&#34;Search&#34;</span>
<span class=p>[</span><span class=nx>goBackHome</span><span class=p>]</span>
  <span class=nx>other</span> <span class=p>=</span> <span class=s2>&#34;Go back to the homepage&#34;</span>
<span class=p>[</span><span class=nx>by</span><span class=p>]</span>
  <span class=nx>other</span> <span class=p>=</span> <span class=s2>&#34;By&#34;</span>
<span class=p>[</span><span class=p>.</span><span class=p>.</span><span class=p>.</span><span class=p>]</span></code></pre></td></tr></tbody></table></div></div><p>De momento solo tengo español e inglés, porque hasta ahí llego, pero por el poder del <em>open source</em> esto es fácilmente mejorable, así que si alguien se anima, ya sabéis, PR al canto en el <a href=https://github.com/asurbernardo/amperage target=_top>repositorio de Amperage</a>!</p><h3 id=nueva-sección-en-inglés>Nueva sección en inglés</h3><p>Ahora que ya hay soporte para traducciones puedo crear una nueva sección en mi web y que esta use un idioma distinto a la de por defecto.</p><p>Para eso hay que especificarla en la configuración del site:</p><div class=highlight><div class=chroma><table class=lntable><tbody><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-toml data-lang=toml><span class=nx>theme</span> <span class=p>=</span> <span class=s2>&#34;amperage&#34;</span>
<span class=nx>DefaultContentLanguage</span> <span class=p>=</span> <span class=s2>&#34;es&#34;</span>
<span class=p>[</span><span class=nx>languages</span><span class=p>]</span>
    <span class=p>[</span><span class=nx>languages</span><span class=p>.</span><span class=nx>es</span><span class=p>]</span>
        <span class=nx>contentDir</span> <span class=p>=</span> <span class=s2>&#34;content&#34;</span>
        <span class=nx>languageName</span> <span class=p>=</span> <span class=s2>&#34;Español&#34;</span>
        <span class=nx>languageCode</span> <span class=p>=</span> <span class=s2>&#34;es&#34;</span>
        <span class=nx>title</span> <span class=p>=</span> <span class=s2>&#34;Bienvenid@ a mi blog | By Asur 🧐&#34;</span>
        <span class=nx>description</span> <span class=p>=</span> <span class=s2>&#34;Bienvenid@ a mi blog, si te gusta el desarrollo web, el SEO,
</span><span class=s2>          el open source y la tecnología en general echa un vistazo, seguro que
</span><span class=s2>          encuentras algo interesante.&#34;</span>
        <span class=nx>weight</span> <span class=p>=</span> <span class=mi>1</span>
    <span class=p>[</span><span class=nx>languages</span><span class=p>.</span><span class=nx>en</span><span class=p>]</span>
        <span class=nx>contentDir</span> <span class=p>=</span> <span class=s2>&#34;content/english&#34;</span>
        <span class=nx>languageName</span> <span class=p>=</span> <span class=s2>&#34;English&#34;</span>
        <span class=nx>languageCode</span> <span class=p>=</span> <span class=s2>&#34;en&#34;</span>
        <span class=nx>title</span> <span class=p>=</span> <span class=s2>&#34;Welcome to my blog | By Asur 🧐&#34;</span>
        <span class=nx>description</span> <span class=p>=</span> <span class=s2>&#34;This is the English section of my site. It&#39;s still a
</span><span class=s2>          work in progress but news are coming! Stay tuned!&#34;</span>
        <span class=nx>weight</span> <span class=p>=</span> <span class=mi>2</span></code></pre></td></tr></tbody></table></div></div><p>Ahora cada idioma tiene una sección separada con sus propios parámetros, y a su vez estos hacen fallback a los genéricos con la misma clave.</p><p>Sé que algún amigo del SEO que lea esto va a entrar en parada diciendo:</p><blockquote><p>Pe-pe-pero no tienes la etiqueta hreflang! 😵</p></blockquote><p>Si, lo sé, es que las etiquetas como <code>&lt;link rel=&#34;alternate&#34; href=&#34;https://example.com/es&#34; hreflang=&#34;es&#34; /&gt;</code> se utilizan para especificar páginas que son una <strong>alternativa directa</strong> en otro idioma, no se puede usar para páginas con contenidos distintos.</p><p>Quizás el único punto en el que esto tendría sentido es en ambas homepages pero de momento lo he dejado correr, me conformo con el <code>&lt;html ⚡ lang=&#34;en&#34;&gt;</code>.</p><p>Ah si! El link? <a href=https://asur.dev/en target=_top>Aquí podéis ver la sección en inglés</a>.</p><h2 id=siguientes-pasos>Siguientes pasos 👣</h2><p>Aprovechando la nueva sección en inglés creo que la voy a escribir mi primer post en otro idioma, ya tengo una idea bastante aterrizada de que puede tratar y es la leche, pero vais a tener que esperar para verlo, <em>stay tuned!</em> 😜</p><h2 id=wayback-machine>Wayback Machine ⏰</h2><p>Ver la <a href=https://web.archive.org/web/20191202111737/https://asur.dev/metablogs/pwa-en-amp-con-service-worker-e-i18n/ target=_top title="Versión original del post">versión original de este post</a>.</p><p>Ver la <a href=https://web.archive.org/web/20191202111805/https://asur.dev/en/ target=_top title="Versión original de la sección en inglés">versión original de la sección en inglés</a>.</p><h2 class=related-content__title>Lecturas relacionadas 📖</h2><p class=related-content__item><a data-rel=prefetch href=https://asur.dev/metablogs/nuevo-dominio-legibilidad-integracion-amp-scripts/ target=_top>Metablog #4 - Nuevo dominio, nuevo layout y más AMP!</a></p><p class=related-content__item><a data-rel=prefetch href=https://asur.dev/metablogs/mejorando-workflow-docker-makefile-github-actions/ target=_top>Metablog #3 - Workflow con docker, makefile y Github actions</a></p><p class=related-content__item><a data-rel=prefetch href=https://asur.dev/metablogs/la-primera-iteracion-amp-estilos-y-miscelanea/ target=_top>Metablog #1 - AMP, estilos y otras misceláneas</a></p><section class=author><p class=author__name>Asur Bernardo</p><amp-img class="author__image i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=200 i-amphtml-layout=fixed layout=fixed src=https://asur.dev/images/me.jpg style=width:200px;height:200px; width=200></amp-img><p class=author__bio>Back end developer sin ningún tipo de gusto estético. Me encanta el cacharreo y la tecnología. Siempre intento aprender cosas nuevas.</p><p class=author__cta>✨ ¡Si te ha costado comparte y comenta! ✨</p><div class=social-share><amp-social-share aria-label="Compartir contenido" class="social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=system width=50></amp-social-share><amp-social-share aria-label="Compartir en Facebook" class="social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=facebook width=50></amp-social-share><amp-social-share aria-label="Compartir en Twitter" class="social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=twitter width=50></amp-social-share><amp-social-share aria-label="Compartir en Linkedin" class="social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=linkedin width=50></amp-social-share><amp-social-share aria-label="Compartir en Pinterest" class="social-share__button i-amphtml-layout-fixed i-amphtml-layout-size-defined" height=50 i-amphtml-layout=fixed style=width:50px;height:50px; type=pinterest width=50></amp-social-share></div></section><amp-iframe class="i-amphtml-layout-responsive i-amphtml-layout-size-defined" height=180 i-amphtml-layout=responsive layout=responsive resizable sandbox="allow-scripts allow-same-origin allow-modals allow-popups allow-forms" src="https://comments.asur.dev?id=1e5d47c0d19bc53af43378e2236e6eae&amp;url=https%3a%2f%2fasur.dev%2fmetablogs%2fpwa-en-amp-con-service-worker-e-i18n%2f" width=600><i-amphtml-sizer style=display:block;padding-top:30.0000%;></i-amphtml-sizer><div aria-label="Load more" overflow role=button style="display:block;font-size:14px;font-weight:500;text-align:center;line-height:1.1;padding:12px 16px;border-radius:4px;background:rgba(29,47,58,.6);color:#fff" tabindex=0>Load more</div></amp-iframe></article></main><footer class=footer><div class=footer__copyright>© asur.dev 2020</div><div class=footer__languages><b>Español</b>
<a data-rel=prefetch href=https://asur.dev/en target=_top>English</a></div></footer></body></html>
